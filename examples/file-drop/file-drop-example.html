<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FileDropMixin Example - MOJO Framework</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Bootstrap Icons -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />
        <!-- MOJO Core Styles -->
        <link href="../../src/css/core.css" rel="stylesheet" />

        <style>
            .example-container {
                border: 2px dashed #dee2e6;
                border-radius: 0.5rem;
                padding: 2rem;
                margin: 1rem 0;
                text-align: center;
                min-height: 200px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .example-container:hover {
                border-color: #6c757d;
                background-color: #f8f9fa;
            }

            .custom-drop-zone {
                border: 2px solid #28a745;
                background-color: #d4edda;
                border-radius: 0.375rem;
                padding: 1rem;
                margin: 0.5rem 0;
                min-height: 120px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .file-list {
                max-height: 200px;
                overflow-y: auto;
            }

            .file-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0.5rem;
                border: 1px solid #dee2e6;
                border-radius: 0.25rem;
                margin: 0.25rem 0;
                background-color: #f8f9fa;
            }

            .file-info {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .log-container {
                background-color: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                padding: 1rem;
                max-height: 300px;
                overflow-y: auto;
                font-family: monospace;
                font-size: 0.875rem;
            }

            .log-entry {
                margin: 0.25rem 0;
                padding: 0.25rem 0;
            }

            .log-success {
                color: #28a745;
            }
            .log-error {
                color: #dc3545;
            }
            .log-info {
                color: #0d6efd;
            }
            .log-warning {
                color: #fd7e14;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid my-4">
            <div class="row">
                <div class="col-12">
                    <h1 class="text-center mb-4">
                        <i class="bi bi-cloud-arrow-up"></i> FileDropMixin Examples
                    </h1>
                    <p class="lead text-center mb-5">
                        Comprehensive examples showing how to use the FileDropMixin to add
                        drag-and-drop functionality to any MOJO View
                    </p>
                </div>
            </div>

            <!-- Example 1: Basic Image Drop -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-image"></i> Example 1: Basic Image Drop</h5>
                            <small class="text-muted"
                                >Images only, single file, auto-validation</small
                            >
                        </div>
                        <div class="card-body">
                            <div id="basic-example"></div>
                        </div>
                    </div>
                </div>

                <!-- Example 2: Multiple Files -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-files"></i> Example 2: Multiple Documents</h5>
                            <small class="text-muted">Documents, multiple files allowed</small>
                        </div>
                        <div class="card-body">
                            <div id="multiple-example"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Example 3: Custom Drop Zone -->
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-bullseye"></i> Example 3: Custom Drop Zone</h5>
                            <small class="text-muted">Specific drop zone, any file type</small>
                        </div>
                        <div class="card-body">
                            <div id="custom-example"></div>
                        </div>
                    </div>
                </div>

                <!-- Example 4: No Visual Feedback -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-eye-slash"></i> Example 4: No Visual Feedback</h5>
                            <small class="text-muted"
                                >Disabled drag styling, custom validation</small
                            >
                        </div>
                        <div class="card-body">
                            <div id="no-feedback-example"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Example 5: Error Handling -->
            <div class="row mt-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>
                                <i class="bi bi-exclamation-triangle"></i> Example 5: Error Handling
                            </h5>
                            <small class="text-muted">Strict validation, error demonstration</small>
                        </div>
                        <div class="card-body">
                            <div id="error-example"></div>
                        </div>
                    </div>
                </div>

                <!-- Example 6: Large Files -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-hdd"></i> Example 6: Large Files</h5>
                            <small class="text-muted"
                                >Large file support, progress simulation</small
                            >
                        </div>
                        <div class="card-body">
                            <div id="large-example"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5><i class="bi bi-terminal"></i> Debug Log</h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearLog()">
                                Clear Log
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="debug-log" class="log-container">
                                <div class="log-entry log-info">
                                    FileDropMixin examples loaded. Try dropping files above!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- MOJO Framework -->
        <script type="module">
            import View from "../../src/core/View.js";
            import applyFileDropMixin from "../../src/components/FileDropMixin.js";

            // Apply FileDropMixin to View class
            applyFileDropMixin(View);

            // Store view instances for cleanup
            window.dropViews = {};

            // Debug logging utility
            window.log = function (message, type = "info") {
                const logContainer = document.getElementById("debug-log");
                const timestamp = new Date().toLocaleTimeString();
                const entry = document.createElement("div");
                entry.className = `log-entry log-${type}`;
                entry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
                logContainer.appendChild(entry);
                logContainer.scrollTop = logContainer.scrollHeight;
                console.log(`[FileDropMixin] ${message}`);
            };

            window.clearLog = function () {
                document.getElementById("debug-log").innerHTML = "";
            };

            // Utility to format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return "0 Bytes";
                const k = 1024;
                const sizes = ["Bytes", "KB", "MB", "GB"];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
            }

            // Example 1: Basic Image Drop
            class BasicImageDropView extends View {
                constructor(options) {
                    super(options);

                    this.enableFileDrop({
                        acceptedTypes: ["image/jpeg", "image/png", "image/gif", "image/webp"],
                        maxFileSize: 5 * 1024 * 1024, // 5MB
                        multiple: false,
                        validateOnDrop: true,
                    });
                }

                async getTemplate() {
                    return `
                        <div class="example-container">
                            <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #6c757d;"></i>
                            <h6 class="mt-3">Drop an image here</h6>
                            <p class="text-muted">Accepts: JPEG, PNG, GIF, WebP (max 5MB)</p>
                        </div>
                        <div id="basic-result" class="mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    log(`Basic example: Received ${files.length} file(s)`, "success");

                    const file = files[0];
                    const resultDiv = document.getElementById("basic-result");

                    resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i>
                        <strong>File dropped:</strong> ${file.name} (${formatFileSize(file.size)})
                        <br><small>Type: ${file.type}</small>
                    </div>
                `;

                    // Show image preview if it's an image
                    if (file.type.startsWith("image/")) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            resultDiv.innerHTML += `
                            <div class="text-center">
                                <img src="${e.target.result}" class="img-thumbnail" style="max-height: 200px;">
                            </div>
                        `;
                        };
                        reader.readAsDataURL(file);
                    }
                }

                async onFileDropError(error, event, files) {
                    log(`Basic example error: ${error.message}`, "error");
                    document.getElementById("basic-result").innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
                }
            }

            // Example 2: Multiple Files
            class MultipleFilesView extends View {
                constructor(options) {
                    super(options);

                    this.droppedFiles = [];

                    this.enableFileDrop({
                        acceptedTypes: [
                            "application/pdf",
                            "application/msword",
                            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                            "text/plain",
                        ],
                        maxFileSize: 10 * 1024 * 1024, // 10MB
                        multiple: true,
                        validateOnDrop: true,
                    });
                }

                async getTemplate() {
                    return `
                        <div class="example-container">
                            <i class="bi bi-file-earmark-text" style="font-size: 3rem; color: #6c757d;"></i>
                            <h6 class="mt-3">Drop documents here</h6>
                            <p class="text-muted">Accepts: PDF, DOC, TXT (multiple files, max 10MB each)</p>
                        </div>
                        <div id="multiple-files" class="file-list mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    log(`Multiple files example: Received ${files.length} file(s)`, "success");

                    this.droppedFiles.push(...files);
                    this.updateFileList();
                }

                async onFileDropError(error, event, files) {
                    log(`Multiple files error: ${error.message}`, "error");
                }

                updateFileList() {
                    const container = document.getElementById("multiple-files");

                    if (this.droppedFiles.length === 0) {
                        container.innerHTML = '<p class="text-muted">No files dropped yet</p>';
                        return;
                    }

                    container.innerHTML = this.droppedFiles
                        .map(
                            (file, index) => `
                    <div class="file-item">
                        <div class="file-info">
                            <i class="bi bi-file-earmark-text text-primary"></i>
                            <span><strong>${file.name}</strong></span>
                            <small class="text-muted">(${formatFileSize(file.size)})</small>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeFile(${index})">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                `,
                        )
                        .join("");
                }
            }

            // Global function to remove files
            window.removeFile = function (index) {
                if (window.dropViews.multiple) {
                    window.dropViews.multiple.droppedFiles.splice(index, 1);
                    window.dropViews.multiple.updateFileList();
                    log(`Removed file at index ${index}`, "info");
                }
            };

            // Example 3: Custom Drop Zone
            class CustomDropZoneView extends View {
                constructor(options) {
                    super(options);

                    this.enableFileDrop({
                        acceptedTypes: ["*/*"], // Any file type
                        maxFileSize: 50 * 1024 * 1024, // 50MB
                        dropZoneSelector: ".custom-drop-zone",
                        multiple: false,
                        validateOnDrop: true,
                    });
                }

                async getTemplate() {
                    return `
                        <p>Drop files anywhere in this card, but only the green zone will accept them:</p>
                        <div class="custom-drop-zone">
                            <strong><i class="bi bi-download"></i> Custom Drop Zone</strong>
                            <br><small>Any file type accepted here</small>
                        </div>
                        <p class="text-muted">This area won't accept drops</p>
                        <div id="custom-result" class="mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    log(`Custom drop zone: Received file in custom zone`, "success");

                    const file = files[0];
                    document.getElementById("custom-result").innerHTML = `
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Dropped in custom zone:</strong> ${file.name}
                        <br><small>Size: ${formatFileSize(file.size)} | Type: ${file.type}</small>
                    </div>
                `;
                }

                async onFileDropError(error, event, files) {
                    log(`Custom drop zone error: ${error.message}`, "error");
                }
            }

            // Example 4: No Visual Feedback
            class NoFeedbackView extends View {
                constructor(options) {
                    super(options);

                    this.enableFileDrop({
                        acceptedTypes: [
                            "text/javascript",
                            "text/html",
                            "text/css",
                            "application/json",
                        ],
                        maxFileSize: 1 * 1024 * 1024, // 1MB
                        multiple: false,
                        visualFeedback: false, // Disable visual feedback
                        validateOnDrop: false, // We'll do custom validation
                    });
                }

                async getTemplate() {
                    return `
                        <div class="example-container">
                            <i class="bi bi-file-code" style="font-size: 3rem; color: #6c757d;"></i>
                            <h6 class="mt-3">Drop code files here</h6>
                            <p class="text-muted">No visual feedback, custom validation</p>
                        </div>
                        <div id="no-feedback-result" class="mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    const file = files[0];

                    // Custom validation
                    if (!file.name.match(/\.(js|html|css|json)$/i)) {
                        this.onFileDropError(
                            new Error("Only code files (.js, .html, .css, .json) are allowed"),
                            event,
                            files,
                        );
                        return;
                    }

                    log(`No feedback example: Code file accepted`, "success");

                    document.getElementById("no-feedback-result").innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-code-square"></i>
                        <strong>Code file accepted:</strong> ${file.name}
                        <br><small>No visual feedback was shown during drag</small>
                    </div>
                `;
                }

                async onFileDropError(error, event, files) {
                    log(`No feedback error: ${error.message}`, "error");
                    document.getElementById("no-feedback-result").innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
                }
            }

            // Example 5: Error Handling
            class ErrorHandlingView extends View {
                constructor(options) {
                    super(options);

                    this.enableFileDrop({
                        acceptedTypes: ["image/png"], // Only PNG
                        maxFileSize: 1024 * 1024, // 1MB - very strict
                        multiple: false,
                        validateOnDrop: true,
                    });
                }

                async getTemplate() {
                    return `
                        <div class="example-container">
                            <i class="bi bi-shield-exclamation" style="font-size: 3rem; color: #6c757d;"></i>
                            <h6 class="mt-3">Strict validation zone</h6>
                            <p class="text-muted">Only PNG files under 1MB accepted</p>
                        </div>
                        <div id="error-result" class="mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    log(`Error example: PNG file accepted`, "success");

                    const file = files[0];
                    document.getElementById("error-result").innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check2-circle"></i>
                        <strong>Validation passed:</strong> ${file.name}
                        <br><small>This file met all strict requirements</small>
                    </div>
                `;
                }

                async onFileDropError(error, event, files) {
                    log(`Error example: ${error.message}`, "error");

                    const file = files ? files[0] : null;
                    let details = "";

                    if (file) {
                        details = `<br><small>File: ${file.name} (${formatFileSize(file.size)}, ${file.type})</small>`;
                    }

                    document.getElementById("error-result").innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-shield-exclamation"></i>
                        <strong>Validation failed:</strong> ${error.message}
                        ${details}
                    </div>
                `;
                }
            }

            // Example 6: Large Files
            class LargeFilesView extends View {
                constructor(options) {
                    super(options);

                    this.enableFileDrop({
                        acceptedTypes: ["*/*"],
                        maxFileSize: 100 * 1024 * 1024, // 100MB
                        multiple: false,
                        validateOnDrop: true,
                    });
                }

                async getTemplate() {
                    return `
                        <div class="example-container">
                            <i class="bi bi-database" style="font-size: 3rem; color: #6c757d;"></i>
                            <h6 class="mt-3">Drop large files here</h6>
                            <p class="text-muted">Up to 100MB accepted</p>
                        </div>
                        <div id="large-result" class="mt-3"></div>
                    `;
                }

                async onFileDrop(files, event, validation) {
                    const file = files[0];
                    log(
                        `Large files example: Processing ${file.name} (${formatFileSize(file.size)})`,
                        "success",
                    );

                    const resultDiv = document.getElementById("large-result");

                    // Show progress simulation for large files
                    if (file.size > 10 * 1024 * 1024) {
                        // > 10MB
                        resultDiv.innerHTML = `
                        <div class="alert alert-info">
                            <i class="bi bi-clock"></i>
                            <strong>Processing large file:</strong> ${file.name}
                            <div class="progress mt-2">
                                <div class="progress-bar progress-bar-striped progress-bar-animated"
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                    `;

                        // Simulate progress
                        const progressBar = resultDiv.querySelector(".progress-bar");
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += Math.random() * 20;
                            if (progress >= 100) {
                                progress = 100;
                                clearInterval(interval);

                                setTimeout(() => {
                                    resultDiv.innerHTML = `
                                    <div class="alert alert-success">
                                        <i class="bi bi-check-circle"></i>
                                        <strong>Large file processed:</strong> ${file.name}
                                        <br><small>Size: ${formatFileSize(file.size)}</small>
                                    </div>
                                `;
                                }, 500);
                            }
                            progressBar.style.width = `${progress}%`;
                        }, 200);
                    } else {
                        resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i>
                            <strong>File accepted:</strong> ${file.name}
                            <br><small>Size: ${formatFileSize(file.size)}</small>
                        </div>
                    `;
                    }
                }

                async onFileDropError(error, event, files) {
                    log(`Large files error: ${error.message}`, "error");
                    document.getElementById("large-result").innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
                }
            }

            // Initialize all examples
            async function initializeExamples() {
                log("Initializing FileDropMixin examples...", "info");

                try {
                    // Example 1: Basic Image Drop
                    window.dropViews.basic = new BasicImageDropView();
                    await window.dropViews.basic.render(
                        true,
                        document.getElementById("basic-example"),
                    );

                    // Example 2: Multiple Files
                    window.dropViews.multiple = new MultipleFilesView();
                    await window.dropViews.multiple.render(
                        true,
                        document.getElementById("multiple-example"),
                    );

                    // Example 3: Custom Drop Zone
                    window.dropViews.custom = new CustomDropZoneView();
                    await window.dropViews.custom.render(
                        true,
                        document.getElementById("custom-example"),
                    );

                    // Example 4: No Visual Feedback
                    window.dropViews.noFeedback = new NoFeedbackView();
                    await window.dropViews.noFeedback.render(
                        true,
                        document.getElementById("no-feedback-example"),
                    );

                    // Example 5: Error Handling
                    window.dropViews.error = new ErrorHandlingView();
                    await window.dropViews.error.render(
                        true,
                        document.getElementById("error-example"),
                    );

                    // Example 6: Large Files
                    window.dropViews.large = new LargeFilesView();
                    await window.dropViews.large.render(
                        true,
                        document.getElementById("large-example"),
                    );

                    log("All examples initialized successfully!", "success");
                } catch (error) {
                    log(`Error initializing examples: ${error.message}`, "error");
                    console.error("Initialization error:", error);
                }
            }

            // Initialize when DOM is loaded
            document.addEventListener("DOMContentLoaded", initializeExamples);

            // Cleanup function
            window.addEventListener("beforeunload", async () => {
                for (const [name, view] of Object.entries(window.dropViews)) {
                    if (view && typeof view.destroy === "function") {
                        await view.destroy();
                    }
                }
            });
        </script>
    </body>
</html>
