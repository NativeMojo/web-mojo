<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MOJO Charts Examples</title>

        <!-- Bootstrap 5.3 CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />

        <style>
            .chart-component {
                border-radius: 0.5rem;
                border: 1px solid rgba(0, 0, 0, 0.1);
                background: white;
                margin-bottom: 2rem;
                padding: 1.5rem;
                min-height: 400px;
            }

            [data-theme="dark"] .chart-component {
                background: #2d3748;
                border-color: rgba(255, 255, 255, 0.1);
            }

            .example-section {
                margin-bottom: 4rem;
            }

            .example-code {
                background: #f8f9fa;
                border-radius: 0.5rem;
                padding: 1rem;
                margin-top: 1rem;
            }

            [data-theme="dark"] .example-code {
                background: #1a202c;
            }

            .demo-controls {
                background: #f8f9fa;
                border-radius: 0.5rem;
                padding: 1rem;
                margin-bottom: 2rem;
            }

            [data-theme="dark"] .demo-controls {
                background: #1a202c;
            }

            .status-log {
                max-height: 200px;
                overflow-y: auto;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                padding: 0.75rem;
                margin: 1rem 0;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid py-4">
            <!-- Header -->
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h1 class="display-4 fw-bold">MOJO Charts Examples</h1>
                            <p class="lead text-muted">
                                Interactive data visualization components built on Chart.js
                            </p>
                        </div>
                        <div>
                            <button class="btn btn-outline-secondary" id="toggleTheme">
                                <i class="bi bi-palette"></i> Toggle Theme
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Log -->
            <div class="row">
                <div class="col-12">
                    <div class="status-log" id="statusLog">
                        <small class="text-muted">Loading...</small>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="demo-controls">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h6 class="mb-2">Demo Controls</h6>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-primary" onclick="createLineChart()">
                                <i class="bi bi-graph-up"></i> Line Chart
                            </button>
                            <button class="btn btn-sm btn-success" onclick="createBarChart()">
                                <i class="bi bi-bar-chart"></i> Bar Chart
                            </button>
                            <button class="btn btn-sm btn-info" onclick="createPieChart()">
                                <i class="bi bi-pie-chart"></i> Pie Chart
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="createAllCharts()">
                                <i class="bi bi-lightning"></i> All Charts
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="testSimpleChart()">
                                <i class="bi bi-bug"></i> Test Simple
                            </button>
                            <button
                                class="btn btn-sm btn-outline-dark"
                                onclick="testDirectChartJS()"
                            >
                                <i class="bi bi-code"></i> Direct Chart.js
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <small class="text-muted">
                            <i class="bi bi-info-circle"></i>
                            Click buttons to create charts • Charts will appear below
                        </small>
                    </div>
                </div>
            </div>

            <!-- Chart Examples -->
            <div class="example-section">
                <div class="row">
                    <!-- Line Chart -->
                    <div class="col-lg-6">
                        <h3>Line Chart</h3>
                        <div id="lineChartContainer" class="chart-component">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-graph-up display-4 mb-3"></i>
                                <p>Click "Line Chart" button to create chart</p>
                            </div>
                        </div>
                        <div class="example-code">
                            <small class="text-muted d-block mb-2">Code:</small>
                            <code>
                                const lineChart = new SeriesChart({<br />
                                &nbsp;&nbsp;title: 'Sales Trend',<br />
                                &nbsp;&nbsp;chartType: 'line',<br />
                                &nbsp;&nbsp;data: salesData<br />
                                });
                            </code>
                        </div>
                    </div>

                    <!-- Bar Chart -->
                    <div class="col-lg-6">
                        <h3>Bar Chart</h3>
                        <div id="barChartContainer" class="chart-component">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-bar-chart display-4 mb-3"></i>
                                <p>Click "Bar Chart" button to create chart</p>
                            </div>
                        </div>
                        <div class="example-code">
                            <small class="text-muted d-block mb-2">Code:</small>
                            <code>
                                const barChart = new SeriesChart({<br />
                                &nbsp;&nbsp;title: 'Revenue',<br />
                                &nbsp;&nbsp;chartType: 'bar',<br />
                                &nbsp;&nbsp;data: revenueData<br />
                                });
                            </code>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Pie Chart -->
                    <div class="col-lg-8 mx-auto">
                        <h3>Pie Chart</h3>
                        <div id="pieChartContainer" class="chart-component">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-pie-chart display-4 mb-3"></i>
                                <p>Click "Pie Chart" button to create chart</p>
                            </div>
                        </div>
                        <div class="example-code">
                            <small class="text-muted d-block mb-2">Code:</small>
                            <code>
                                const pieChart = new PieChart({<br />
                                &nbsp;&nbsp;title: 'Market Share',<br />
                                &nbsp;&nbsp;data: marketData<br />
                                });
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

        <!-- MOJO Framework -->
        <script type="module">
            import { SeriesChart, PieChart } from "../src/charts/index.js";

            // Make components available globally
            window.SeriesChart = SeriesChart;
            window.PieChart = PieChart;

            // Status logging
            const statusLog = document.getElementById("statusLog");
            function log(message, type = "info") {
                const timestamp = new Date().toLocaleTimeString();
                const div = document.createElement("div");
                div.innerHTML = `<small class="text-muted">${timestamp}</small> ${message}`;
                statusLog.appendChild(div);
                statusLog.scrollTop = statusLog.scrollHeight;
                console.log(`[${type}] ${message}`);
            }

            // Check Chart.js availability
            function checkChartJS() {
                if (typeof window.Chart !== "undefined") {
                    log(`✅ Chart.js loaded (version: ${window.Chart.version || "unknown"})`);
                    return true;
                } else {
                    log(`❌ Chart.js not loaded`);
                    return false;
                }
            }

            // Sample data
            const sampleData = {
                sales: {
                    labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
                    datasets: [
                        {
                            label: "Sales ($)",
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: "rgb(54, 162, 235)",
                            backgroundColor: "rgba(54, 162, 235, 0.2)",
                            fill: true,
                        },
                    ],
                },
                revenue: {
                    labels: ["Q1", "Q2", "Q3", "Q4"],
                    datasets: [
                        {
                            label: "Revenue ($)",
                            data: [45000, 62000, 58000, 71000],
                            backgroundColor: "rgba(40, 167, 69, 0.8)",
                            borderColor: "rgba(40, 167, 69, 1)",
                            borderWidth: 1,
                        },
                    ],
                },
                market: [
                    { label: "Company A", value: 35 },
                    { label: "Company B", value: 25 },
                    { label: "Company C", value: 20 },
                    { label: "Others", value: 20 },
                ],
            };

            // Chart creation functions
            window.createLineChart = async function () {
                try {
                    log("Creating line chart...");
                    checkChartJS();

                    const container = document.getElementById("lineChartContainer");
                    container.innerHTML = ""; // Clear container

                    log(`Data being used: ${JSON.stringify(sampleData.sales, null, 2)}`);

                    const chart = new SeriesChart({
                        title: "Monthly Sales Trend",
                        chartType: "line",
                        data: sampleData.sales,
                        xAxis: { formatter: "category" },
                    });

                    log("SeriesChart instance created");
                    await chart.render();
                    log("Chart rendered");
                    container.appendChild(chart.element);
                    log("Chart element added to container");
                    await chart.mount();
                    log("Chart mounted");

                    // Check if Chart.js instance was created
                    if (chart.chart) {
                        log(`✅ Chart.js instance created successfully`);
                        log(`Chart.js data: ${JSON.stringify(chart.chart.data, null, 2)}`);
                        log(
                            `Chart.js options: ${JSON.stringify(chart.chart.options.scales, null, 2)}`,
                        );
                        log(`Chart type: ${chart.chart.config.type}`);
                        log(`Canvas element: ${chart.canvas ? "exists" : "missing"}`);
                    } else {
                        log(`❌ Chart.js instance not created`);
                    }

                    log("✅ Line chart created successfully", "success");
                } catch (error) {
                    log(`❌ Error creating line chart: ${error.message}`, "error");
                    console.error("Full error:", error);
                    console.error("Stack trace:", error.stack);
                }
            };

            window.createBarChart = async function () {
                try {
                    log("Creating bar chart...");
                    checkChartJS();

                    const container = document.getElementById("barChartContainer");
                    container.innerHTML = ""; // Clear container

                    log(`Data being used: ${JSON.stringify(sampleData.revenue, null, 2)}`);

                    const chart = new SeriesChart({
                        title: "Quarterly Revenue",
                        chartType: "bar",
                        data: sampleData.revenue,
                        xAxis: { formatter: "category" },
                    });

                    log("SeriesChart instance created");
                    await chart.render();
                    log("Chart rendered");
                    container.appendChild(chart.element);
                    log("Chart element added to container");
                    await chart.mount();
                    log("Chart mounted");

                    // Check if Chart.js instance was created
                    if (chart.chart) {
                        log(`✅ Chart.js instance created successfully`);
                        log(`Chart.js data: ${JSON.stringify(chart.chart.data, null, 2)}`);
                        log(
                            `Chart.js options: ${JSON.stringify(chart.chart.options.scales, null, 2)}`,
                        );
                        log(`Chart type: ${chart.chart.config.type}`);
                        log(`Canvas element: ${chart.canvas ? "exists" : "missing"}`);
                    } else {
                        log(`❌ Chart.js instance not created`);
                    }

                    log("✅ Bar chart created successfully", "success");
                } catch (error) {
                    log(`❌ Error creating bar chart: ${error.message}`, "error");
                    console.error("Full error:", error);
                    console.error("Stack trace:", error.stack);
                }
            };

            window.createPieChart = async function () {
                try {
                    log("Creating pie chart...");
                    const container = document.getElementById("pieChartContainer");
                    container.innerHTML = ""; // Clear container

                    const chart = new PieChart({
                        title: "Market Share Distribution",
                        data: sampleData.market,
                    });

                    await chart.render();
                    container.appendChild(chart.element);
                    await chart.mount();

                    // Debug PieChart for comparison
                    if (chart.chart) {
                        log(`PieChart Chart.js data: ${JSON.stringify(chart.chart.data, null, 2)}`);
                        log(`PieChart type: ${chart.chart.config.type}`);
                    }

                    log("✅ Pie chart created successfully", "success");
                } catch (error) {
                    log(`❌ Error creating pie chart: ${error.message}`, "error");
                    console.error(error);
                }
            };

            window.createAllCharts = async function () {
                await createLineChart();
                await createBarChart();
                await createPieChart();
            };

            // Simple test function to isolate issues
            window.testSimpleChart = async function () {
                try {
                    log("Testing simple chart creation...");

                    const container = document.getElementById("lineChartContainer");
                    container.innerHTML = ""; // Clear container

                    // Very simple data format
                    const simpleData = {
                        labels: ["A", "B", "C"],
                        datasets: [
                            {
                                label: "Test",
                                data: [10, 20, 30],
                                backgroundColor: "rgba(255, 99, 132, 0.2)",
                                borderColor: "rgba(255, 99, 132, 1)",
                                borderWidth: 1,
                            },
                        ],
                    };

                    log(`Simple data: ${JSON.stringify(simpleData)}`);

                    const chart = new SeriesChart({
                        title: "Simple Test Chart",
                        chartType: "line",
                        data: simpleData,
                        xAxis: { formatter: "category" },
                    });

                    log("Simple chart instance created");
                    await chart.render();
                    log("Simple chart rendered");
                    container.appendChild(chart.element);
                    log("Simple chart element added");
                    await chart.mount();
                    log("Simple chart mounted");

                    if (chart.chart) {
                        log(`✅ Simple chart Chart.js instance: ${typeof chart.chart}`);
                        log(`Simple Chart data: ${JSON.stringify(chart.chart.data, null, 2)}`);
                        log(`Simple Chart datasets count: ${chart.chart.data.datasets.length}`);
                        log(
                            `Simple Chart first dataset data: ${JSON.stringify(chart.chart.data.datasets[0].data)}`,
                        );
                        log(`Simple Chart labels: ${JSON.stringify(chart.chart.data.labels)}`);
                    } else {
                        log(`❌ Simple chart Chart.js instance not created`);
                    }
                } catch (error) {
                    log(`❌ Simple test error: ${error.message}`, "error");
                    console.error("Simple test full error:", error);
                }
            };

            // Direct Chart.js test (bypass our wrapper)
            window.testDirectChartJS = async function () {
                try {
                    log("Testing direct Chart.js creation...");

                    const container = document.getElementById("barChartContainer");
                    container.innerHTML = ""; // Clear container

                    // Create canvas directly
                    const canvas = document.createElement("canvas");
                    canvas.style.width = "100%";
                    canvas.style.height = "400px";
                    container.appendChild(canvas);

                    const ctx = canvas.getContext("2d");

                    // Same data as our SeriesChart
                    const directData = {
                        labels: ["Q1", "Q2", "Q3", "Q4"],
                        datasets: [
                            {
                                label: "Revenue ($)",
                                data: [45000, 62000, 58000, 71000],
                                backgroundColor: "rgba(40, 167, 69, 0.8)",
                                borderColor: "rgba(40, 167, 69, 1)",
                                borderWidth: 1,
                            },
                        ],
                    };

                    log(`Direct Chart.js data: ${JSON.stringify(directData, null, 2)}`);

                    // Create Chart.js instance directly
                    const directChart = new Chart(ctx, {
                        type: "bar",
                        data: directData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: "Direct Chart.js Test",
                                },
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                },
                            },
                        },
                    });

                    log(`✅ Direct Chart.js instance created: ${typeof directChart}`);
                    log(`Direct Chart datasets: ${directChart.data.datasets.length}`);
                    log(
                        `Direct Chart first dataset data: ${JSON.stringify(directChart.data.datasets[0].data)}`,
                    );
                } catch (error) {
                    log(`❌ Direct Chart.js test error: ${error.message}`, "error");
                    console.error("Direct Chart.js full error:", error);
                }
            };

            // Theme toggle
            let isDarkTheme = false;
            document.getElementById("toggleTheme").addEventListener("click", () => {
                isDarkTheme = !isDarkTheme;
                const theme = isDarkTheme ? "dark" : "light";
                document.body.setAttribute("data-theme", theme);
                log(`Theme changed to ${theme}`);
            });

            // Initialize
            log("MOJO Charts loaded successfully! Click buttons above to create charts.");

            // Initial Chart.js check
            setTimeout(() => {
                checkChartJS();
            }, 1000);
        </script>
    </body>
</html>
