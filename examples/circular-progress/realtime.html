<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Real-time CircularProgress - MOJO Charts</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />

        <!-- MOJO Charts CSS -->
        <link href="/src/extensions/charts/css/charts.css" rel="stylesheet" />

        <style>
            body {
                padding: 2rem;
                background: #f8f9fa;
            }

            .demo-section {
                background: white;
                border-radius: 0.5rem;
                padding: 2rem;
                margin-bottom: 2rem;
                box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            }

            .demo-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 2rem;
                align-items: center;
                justify-items: center;
            }

            .demo-item {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .demo-label {
                font-size: 0.875rem;
                color: #6c757d;
                text-align: center;
            }

            .code-example {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                padding: 1rem;
                margin-bottom: 1.5rem;
                font-family: "Courier New", monospace;
                font-size: 0.875rem;
                overflow-x: auto;
            }

            .code-example pre {
                margin: 0;
                white-space: pre;
            }

            .status-indicator {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                font-size: 0.875rem;
                margin-top: 1rem;
            }

            .status-indicator.active {
                background: rgba(25, 135, 84, 0.1);
                color: #198754;
            }

            .status-indicator.paused {
                background: rgba(255, 193, 7, 0.1);
                color: #ffc107;
            }

            .pulse-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: currentColor;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.3;
                }
            }
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <header class="mb-4">
                <h1 class="display-4">Real-time Progress Updates</h1>
                <p class="lead">Simulated real-time progress updates and animations</p>
                <nav>
                    <a href="./index.html" class="btn btn-outline-primary btn-sm">← Back to Main</a>
                    <a href="./segments.html" class="btn btn-outline-secondary btn-sm"
                        >← Multi-Segment</a
                    >
                </nav>
            </header>

            <!-- File Upload Simulation -->
            <section class="demo-section">
                <h2 class="h4 mb-3">File Upload Simulation</h2>
                <div class="code-example">
                    <pre>
// Update progress in real-time
const progress = new CircularProgress({
  value: 0,
  size: "xl",
  label: "UPLOAD",
  containerId: 'upload-progress'
});
await progress.render();

// Update value smoothly
progress.setValue(45); // Animates from current to 45%</pre
                    >
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex justify-content-center">
                            <div id="upload-progress"></div>
                        </div>
                        <div class="text-center">
                            <div id="upload-status" class="status-indicator paused">
                                <div class="pulse-dot"></div>
                                <span>Ready to upload</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Upload Control</h5>
                        <div class="d-flex flex-column gap-2 mt-3">
                            <button class="btn btn-primary" id="startUploadBtn">
                                <i class="bi bi-cloud-upload"></i> Start Upload
                            </button>
                            <button class="btn btn-warning" id="pauseUploadBtn" disabled>
                                <i class="bi bi-pause"></i> Pause
                            </button>
                            <button class="btn btn-secondary" id="cancelUploadBtn" disabled>
                                <i class="bi bi-x-circle"></i> Cancel
                            </button>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <strong>File:</strong> large-video.mp4<br />
                                <strong>Size:</strong> 250 MB<br />
                                <strong>Speed:</strong> <span id="upload-speed">0 MB/s</span>
                            </small>
                        </div>
                    </div>
                </div>
            </section>

            <!-- System Metrics -->
            <section class="demo-section">
                <h2 class="h4 mb-3">System Metrics</h2>
                <div class="code-example">
                    <pre>
// Update metrics continuously
const cpuUsage = new CircularProgress({
  value: 35,
  label: "CPU",
  containerId: 'cpu-usage'
});
await cpuUsage.render();

// Update periodically
setInterval(() => {
  cpuUsage.setValue(Math.random() * 100);
}, 2000);</pre
                    >
                </div>
                <div class="demo-grid">
                    <div class="demo-item">
                        <div id="cpu-usage"></div>
                        <div class="demo-label">CPU Usage</div>
                    </div>

                    <div class="demo-item">
                        <div id="memory-usage"></div>
                        <div class="demo-label">Memory</div>
                    </div>

                    <div class="demo-item">
                        <div id="disk-usage"></div>
                        <div class="demo-label">Disk I/O</div>
                    </div>

                    <div class="demo-item">
                        <div id="network-usage"></div>
                        <div class="demo-label">Network</div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button class="btn btn-sm btn-outline-secondary" id="resetMetricsBtn">
                        <i class="bi bi-arrow-clockwise"></i> Reset Metrics
                    </button>
                </div>
            </section>

            <!-- Build Progress -->
            <section class="demo-section">
                <h2 class="h4 mb-3">Build & Deploy Process</h2>
                <div class="code-example">
                    <pre>
// Multi-segment progress for build steps
const buildProgress = new CircularProgress({
  value: 0,
  segments: [],
  showValue: false,
  containerId: 'build-progress'
});
await buildProgress.render();

// Add segments dynamically
buildProgress.segments = [
  { value: 25, color: "#198754" }
];
buildProgress.renderProgress();</pre
                    >
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex justify-content-center">
                            <div id="build-progress"></div>
                        </div>
                        <div class="text-center">
                            <div id="build-status" class="status-indicator paused">
                                <div class="pulse-dot"></div>
                                <span>Idle</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Build Pipeline</h5>
                        <div class="list-group mt-3">
                            <div class="list-group-item d-flex align-items-center" id="step-1">
                                <i class="bi bi-circle text-muted me-2"></i>
                                <span>Installing dependencies...</span>
                            </div>
                            <div class="list-group-item d-flex align-items-center" id="step-2">
                                <i class="bi bi-circle text-muted me-2"></i>
                                <span>Building project...</span>
                            </div>
                            <div class="list-group-item d-flex align-items-center" id="step-3">
                                <i class="bi bi-circle text-muted me-2"></i>
                                <span>Running tests...</span>
                            </div>
                            <div class="list-group-item d-flex align-items-center" id="step-4">
                                <i class="bi bi-circle text-muted me-2"></i>
                                <span>Deploying to production...</span>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-success" id="startBuildBtn">
                                <i class="bi bi-play-fill"></i> Start Build
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Battery Levels -->
            <section class="demo-section">
                <h2 class="h4 mb-3">Battery Levels (Draining Simulation)</h2>
                <div class="code-example">
                    <pre>
// Change color dynamically based on value
const battery = new CircularProgress({
  value: 85,
  gap: 90,
  containerId: 'battery-1'
});
await battery.render();

// Update value and color
battery.setValue(45);
if (battery.getValue() < 50) {
  battery.setColor("#ffc107"); // Warning color
}</pre
                    >
                </div>
                <div class="demo-grid">
                    <div class="demo-item">
                        <div id="battery-1"></div>
                        <div class="demo-label">Device 1</div>
                    </div>

                    <div class="demo-item">
                        <div id="battery-2"></div>
                        <div class="demo-label">Device 2</div>
                    </div>

                    <div class="demo-item">
                        <div id="battery-3"></div>
                        <div class="demo-label">Device 3</div>
                    </div>

                    <div class="demo-item">
                        <div id="battery-4"></div>
                        <div class="demo-label">Device 4</div>
                    </div>
                </div>
            </section>

            <!-- Timer/Countdown -->
            <section class="demo-section">
                <h2 class="h4 mb-3">Countdown Timer</h2>
                <div class="code-example">
                    <pre>
// Custom value formatter for timer display
const countdown = new CircularProgress({
  value: 100,
  gradientColors: ["#0d6efd", "#6f42c1"],
  valueFormatter: (v) => {
    const seconds = Math.ceil((v / 100) * 1500);
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, "0")}`;
  },
  label: "REMAINING",
  containerId: 'countdown'
});
await countdown.render();</pre
                    >
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex justify-content-center">
                            <div id="countdown"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Pomodoro Timer</h5>
                        <div class="mt-3">
                            <button class="btn btn-primary" id="startTimerBtn">
                                <i class="bi bi-play-fill"></i> Start (25 min)
                            </button>
                            <button class="btn btn-secondary" id="resetTimerBtn">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                        <p class="mt-3 text-muted">
                            Click start to begin a 25-minute Pomodoro session. The timer will count
                            down from 100% to 0%.
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- MOJO Charts Module -->
        <script type="module">
            import { CircularProgress } from "web-mojo/charts";

            // Upload Progress
            const uploadProgress = new CircularProgress({
                value: 0,
                size: "xl",
                color: "#0d6efd",
                label: "UPLOAD",
                clickable: true,
                tooltip: "Upload in progress...",
                containerId: "upload-progress",
            });
            await uploadProgress.render();

            let uploadInterval = null;
            let uploadPaused = false;

            document.getElementById("startUploadBtn").addEventListener("click", () => {
                if (uploadInterval) return;

                uploadPaused = false;
                document.getElementById("startUploadBtn").disabled = true;
                document.getElementById("pauseUploadBtn").disabled = false;
                document.getElementById("cancelUploadBtn").disabled = false;

                const statusEl = document.getElementById("upload-status");
                statusEl.className = "status-indicator active";
                statusEl.innerHTML = '<div class="pulse-dot"></div><span>Uploading...</span>';

                uploadInterval = setInterval(() => {
                    if (!uploadPaused) {
                        const newValue = Math.min(
                            uploadProgress.getValue() + Math.random() * 3,
                            100,
                        );
                        uploadProgress.setValue(newValue);
                        document.getElementById("upload-speed").textContent =
                            (Math.random() * 5 + 2).toFixed(1) + " MB/s";

                        if (newValue >= 100) {
                            clearInterval(uploadInterval);
                            uploadInterval = null;
                            uploadProgress.complete();
                            statusEl.className = "status-indicator active";
                            statusEl.innerHTML =
                                '<i class="bi bi-check-circle"></i><span>Upload complete!</span>';
                            document.getElementById("startUploadBtn").disabled = false;
                            document.getElementById("pauseUploadBtn").disabled = true;
                            document.getElementById("cancelUploadBtn").disabled = true;
                            document.getElementById("upload-speed").textContent = "0 MB/s";
                        }
                    }
                }, 200);
            });

            document.getElementById("pauseUploadBtn").addEventListener("click", () => {
                uploadPaused = !uploadPaused;
                const btn = document.getElementById("pauseUploadBtn");
                const statusEl = document.getElementById("upload-status");

                if (uploadPaused) {
                    btn.innerHTML = '<i class="bi bi-play-fill"></i> Resume';
                    statusEl.className = "status-indicator paused";
                    statusEl.innerHTML = '<i class="bi bi-pause-circle"></i><span>Paused</span>';
                } else {
                    btn.innerHTML = '<i class="bi bi-pause"></i> Pause';
                    statusEl.className = "status-indicator active";
                    statusEl.innerHTML = '<div class="pulse-dot"></div><span>Uploading...</span>';
                }
            });

            document.getElementById("cancelUploadBtn").addEventListener("click", () => {
                clearInterval(uploadInterval);
                uploadInterval = null;
                uploadProgress.reset();
                document.getElementById("startUploadBtn").disabled = false;
                document.getElementById("pauseUploadBtn").disabled = true;
                document.getElementById("cancelUploadBtn").disabled = true;
                document.getElementById("upload-status").className = "status-indicator paused";
                document.getElementById("upload-status").innerHTML = "<span>Cancelled</span>";
                document.getElementById("upload-speed").textContent = "0 MB/s";
            });

            // System Metrics
            const cpuUsage = new CircularProgress({
                value: 35,
                size: "lg",
                color: "#0d6efd",
                label: "CPU",
                containerId: "cpu-usage",
            });
            await cpuUsage.render();

            const memoryUsage = new CircularProgress({
                value: 62,
                size: "lg",
                variant: "warning",
                label: "RAM",
                containerId: "memory-usage",
            });
            await memoryUsage.render();

            const diskUsage = new CircularProgress({
                value: 78,
                size: "lg",
                variant: "success",
                label: "DISK",
                containerId: "disk-usage",
            });
            await diskUsage.render();

            const networkUsage = new CircularProgress({
                value: 45,
                size: "lg",
                variant: "info",
                label: "NET",
                containerId: "network-usage",
            });
            await networkUsage.render();

            // Update metrics
            setInterval(() => {
                cpuUsage.setValue(
                    Math.max(10, Math.min(90, cpuUsage.getValue() + (Math.random() - 0.5) * 10)),
                );
                memoryUsage.setValue(
                    Math.max(40, Math.min(85, memoryUsage.getValue() + (Math.random() - 0.5) * 5)),
                );
                diskUsage.setValue(
                    Math.max(50, Math.min(95, diskUsage.getValue() + (Math.random() - 0.5) * 3)),
                );
                networkUsage.setValue(
                    Math.max(
                        20,
                        Math.min(80, networkUsage.getValue() + (Math.random() - 0.5) * 15),
                    ),
                );
            }, 1000);

            document.getElementById("resetMetricsBtn").addEventListener("click", () => {
                cpuUsage.setValue(35);
                memoryUsage.setValue(62);
                diskUsage.setValue(78);
                networkUsage.setValue(45);
            });

            // Build Progress
            const buildProgress = new CircularProgress({
                value: 0,
                size: "xl",
                segments: [],
                showValue: false,
                containerId: "build-progress",
            });
            await buildProgress.render();

            const buildSteps = [
                { el: "step-1", duration: 2000, label: "Installing dependencies..." },
                { el: "step-2", duration: 3000, label: "Building project..." },
                { el: "step-3", duration: 2500, label: "Running tests..." },
                { el: "step-4", duration: 1500, label: "Deploying to production..." },
            ];

            document.getElementById("startBuildBtn").addEventListener("click", async () => {
                document.getElementById("startBuildBtn").disabled = true;
                document.getElementById("build-status").className = "status-indicator active";
                document.getElementById("build-status").innerHTML =
                    '<div class="pulse-dot"></div><span>Building...</span>';

                // Reset all steps
                buildSteps.forEach((step) => {
                    const el = document.getElementById(step.el);
                    el.querySelector("i").className = "bi bi-circle text-muted me-2";
                });

                const segments = [];

                for (let i = 0; i < buildSteps.length; i++) {
                    const step = buildSteps[i];
                    const el = document.getElementById(step.el);

                    // Mark as in progress
                    el.querySelector("i").className = "bi bi-arrow-repeat spin text-primary me-2";

                    // Add segment
                    segments.push({ value: 25, color: "#0dcaf0" });
                    buildProgress.segments = [...segments];
                    buildProgress.renderProgress();

                    await new Promise((resolve) => setTimeout(resolve, step.duration));

                    // Mark as complete
                    el.querySelector("i").className = "bi bi-check-circle text-success me-2";
                    segments[i] = { value: 25, color: "#198754" };
                    buildProgress.segments = [...segments];
                    buildProgress.renderProgress();
                }

                document.getElementById("build-status").className = "status-indicator active";
                document.getElementById("build-status").innerHTML =
                    '<i class="bi bi-check-circle"></i><span>Build complete!</span>';
                document.getElementById("startBuildBtn").disabled = false;
            });

            // Battery Levels
            const batteries = [];
            const batteryColors = ["#198754", "#0dcaf0", "#ffc107", "#dc3545"];
            const batteryLevels = [85, 60, 35, 15];

            for (let i = 0; i < 4; i++) {
                const battery = new CircularProgress({
                    value: batteryLevels[i],
                    size: "lg",
                    color: batteryColors[i],
                    icon: "bi bi-battery-charging",
                    gap: 90,
                    rotation: -90,
                    containerId: `battery-${i + 1}`,
                });
                await battery.render();
                batteries.push(battery);
            }

            // Drain batteries over time
            setInterval(() => {
                batteries.forEach((battery) => {
                    const newValue = Math.max(0, battery.getValue() - Math.random() * 0.5);
                    battery.setValue(newValue);

                    // Change color based on level
                    if (newValue > 50) {
                        battery.setColor("#198754");
                    } else if (newValue > 20) {
                        battery.setColor("#ffc107");
                    } else {
                        battery.setColor("#dc3545");
                    }
                });
            }, 1000);

            // Countdown Timer
            const countdown = new CircularProgress({
                value: 100,
                size: "xl",
                gradientColors: ["#0d6efd", "#6f42c1"],
                valueFormatter: (v) => {
                    const seconds = Math.ceil((v / 100) * 1500); // 25 minutes = 1500 seconds
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, "0")}`;
                },
                label: "REMAINING",
                rounded: false,
                containerId: "countdown",
            });
            await countdown.render();
            let timerInterval = null;

            document.getElementById("startTimerBtn").addEventListener("click", () => {
                if (timerInterval) return;

                document.getElementById("startTimerBtn").disabled = true;

                timerInterval = setInterval(() => {
                    const newValue = countdown.getValue() - 100 / 1500; // Decrease over 1500 seconds

                    if (newValue <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        countdown.setValue(0);
                        countdown.complete();
                        document.getElementById("startTimerBtn").disabled = false;
                        alert("Pomodoro session complete! Time for a break! ☕");
                    } else {
                        countdown.setValue(newValue, false);
                    }
                }, 1000);
            });

            document.getElementById("resetTimerBtn").addEventListener("click", () => {
                clearInterval(timerInterval);
                timerInterval = null;
                countdown.setValue(100);
                document.getElementById("startTimerBtn").disabled = false;
            });

            // Add spin animation for build progress
            const style = document.createElement("style");
            style.textContent = `
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .spin {
        animation: spin 1s linear infinite;
      }
    `;
            document.head.appendChild(style);
        </script>
    </body>
</html>
