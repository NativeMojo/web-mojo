<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <title>Auth Example â€“ mountAuth</title>

        <!-- Simple Auth CSS (no framework required) -->
        <link rel="stylesheet" href="/src/extensions/auth/css/auth.css" />

        <style>
            /* Optional full-page background for the example (can be customized) */
            :root {
                --auth-gradient-start: #475569;
                --auth-gradient-end: #334155;
            }
            html,
            body {
                height: 100%;
            }
            body {
                margin: 0;
                min-height: 100%;
                display: grid;
                place-items: center;
                background: linear-gradient(
                    135deg,
                    var(--auth-gradient-start),
                    var(--auth-gradient-end)
                );
            }
            /* Center the card responsively */
            #auth-root {
                width: 100%;
                max-width: 480px;
                padding: 1rem;
                box-sizing: border-box;
            }
            /* Optional footer info for the example */
            .example-footer {
                margin-top: 1rem;
                text-align: center;
                color: rgba(255, 255, 255, 0.75);
                font:
                    12px/1.2 system-ui,
                    -apple-system,
                    Segoe UI,
                    Roboto,
                    Helvetica,
                    Arial,
                    sans-serif;
            }
            .example-footer a {
                color: rgba(255, 255, 255, 0.9);
                text-decoration: underline;
            }
        </style>
    </head>
    <body>
        <noscript> This page requires JavaScript to render the authentication UI. </noscript>

        <!-- mountAuth will render into this element -->
        <div id="auth-root"></div>

        <div class="example-footer">
            Example usage of mountAuth. You can pass URL params like
            <code>?apiBase=/api&redirect=/portal/&brand=MyApp&theme=light</code>.
        </div>

        <script type="module">
            // Import the new Simple Auth module
            // Using package import path
            import { mountAuth } from "web-mojo/auth";
            const PROD_BASE = "api/";
            const DEV_API = "http://0.0.0.0:9009/api";
            const API_BASE = window.location.hostname === "localhost" ? DEV_API : PROD_BASE;
            const REDIRECT = "/examples/portal/";
            // Read config from URL params or set sensible defaults
            const params = new URLSearchParams(location.search);
            const redirect =
                params.get("redirect") || params.get("next") || params.get("returnTo") || REDIRECT;
            const apiBase = params.get("apiBase") || API_BASE;
            const brand = params.get("brand") || "MOJO Auth";
            const logo = params.get("logo") || null;
            const theme = params.get("theme") || "light";

            // Optional: restrict final redirects to trusted origins to avoid open-redirects.
            // For the example, we'll leave it undefined. In production, consider something like:
            // const allowRedirectOrigins = [location.origin];

            // Mount the full UI. On success, it redirects to onSuccessRedirect.
            mountAuth(document.getElementById("auth-root"), {
                baseURL: apiBase,
                onSuccessRedirect: redirect,
                // allowRedirectOrigins,
                branding: {
                    title: brand,
                    logoUrl: logo,
                    subtitle: "Sign in to your account",
                },
                theme,
                // Example provider hooks (optional/future-ready). Add your own logic here:
                // providers: {
                //   google: {
                //     onClick: ({ showMessage, redirect }) => {
                //       showMessage('Starting Google sign-in...', 'info');
                //       // TODO: Start OAuth flow and on success call redirect()
                //     },
                //   },
                //   passkey: {
                //     onClick: ({ showMessage }) => {
                //       showMessage('Passkey flow not yet implemented.', 'info');
                //     },
                //   },
                // },
            });
        </script>
    </body>
</html>
