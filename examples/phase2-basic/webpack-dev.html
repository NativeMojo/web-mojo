<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MOJO Framework - Phase 2 Basic Example (Webpack Dev)</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Font Awesome -->
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />

        <style>
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #333;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            }

            .hero-section {
                background: rgba(255, 255, 255, 0.95);
                padding: 40px;
                border-radius: 15px;
                text-align: center;
                margin: 30px 0;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            .hero-section h1 {
                color: #4a5568;
                font-weight: 700;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .stats-section {
                background: rgba(255, 255, 255, 0.9);
                padding: 30px;
                border-radius: 15px;
                margin: 20px 0;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            .demo-section {
                background: rgba(255, 255, 255, 0.9);
                padding: 30px;
                border-radius: 15px;
                margin: 20px 0;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

            .model-demo {
                background: #f8f9fa;
                padding: 25px;
                border-radius: 10px;
                border-left: 5px solid #007bff;
                margin: 20px 0;
            }

            .collection-demo {
                background: #f8f9fa;
                padding: 25px;
                border-radius: 10px;
                border-left: 5px solid #28a745;
                margin: 20px 0;
            }

            .api-demo {
                background: #f8f9fa;
                padding: 25px;
                border-radius: 10px;
                border-left: 5px solid #dc3545;
                margin: 20px 0;
            }

            .stat-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 25px;
                border-radius: 10px;
                text-align: center;
                margin: 10px 0;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                transition: transform 0.3s ease;
            }

            .stat-card:hover {
                transform: translateY(-5px);
            }

            .stat-number {
                font-size: 2.5rem;
                font-weight: 700;
                display: block;
            }

            .code-block {
                background: #2d3748;
                color: #e2e8f0;
                padding: 20px;
                border-radius: 10px;
                font-family: "Consolas", "Monaco", monospace;
                font-size: 0.9rem;
                margin: 15px 0;
                overflow-x: auto;
                border: 1px solid #4a5568;
            }

            .btn-custom {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                color: white;
                padding: 12px 30px;
                border-radius: 25px;
                font-weight: 600;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }

            .btn-custom:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
                color: white;
            }

            .user-item {
                background: white;
                padding: 20px;
                border-radius: 10px;
                margin: 10px 0;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                border-left: 4px solid #007bff;
                transition: transform 0.2s ease;
            }

            .user-item:hover {
                transform: translateX(5px);
            }

            .user-active {
                border-left-color: #28a745;
                background: #f8fff8;
            }

            .user-inactive {
                border-left-color: #dc3545;
                background: #fff8f8;
                opacity: 0.8;
            }

            .console-output {
                background: #1a1a1a;
                color: #00ff00;
                padding: 15px;
                border-radius: 8px;
                font-family: "Consolas", "Monaco", monospace;
                font-size: 0.85rem;
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid #333;
                margin: 15px 0;
            }

            .loading-spinner {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top-color: #fff;
                animation: spin 1s ease-in-out infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .fade-in {
                animation: fadeIn 0.5s ease-out;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .fade-in {
                animation: fadeIn 0.5s ease-out;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- Hero Section -->
            <div class="hero-section">
                <h1><i class="fas fa-database me-3"></i>MOJO Framework v2.0.0</h1>
                <p class="lead mb-0">Phase 2: Data Layer - RestModel & DataList Demo (Webpack Dev)</p>
                <small class="text-muted d-block mt-2">Using bundled files for webpack development</small>
            </div>

            <!-- Statistics Row -->
            <div class="stats-section">
                <h3 class="text-center mb-4"><i class="fas fa-chart-bar me-2"></i>Framework Statistics</h3>
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <span class="stat-number" id="user-count">0</span>
                            <span>Total Users</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <span class="stat-number" id="active-count">0</span>
                            <span>Active Users</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <span class="stat-number" id="api-calls">0</span>
                            <span>API Calls</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <span class="stat-number" id="validation-checks">0</span>
                            <span>Validations</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Demo Sections -->
            <div class="row">
                <div class="col-lg-6">
                    <!-- RestModel Demo -->
                    <div class="model-demo">
                        <h4><i class="fas fa-user me-2"></i>RestModel Demo</h4>
                        <p>Demonstrates CRUD operations, validation, and model features</p>

                        <div class="mb-3">
                            <button class="btn btn-custom me-2" onclick="createUser()">
                                <i class="fas fa-plus me-1"></i>Create User
                            </button>
                            <button class="btn btn-custom me-2" onclick="validateUser()">
                                <i class="fas fa-check me-1"></i>Validate
                            </button>
                            <button class="btn btn-custom me-2" onclick="updateUser()">
                                <i class="fas fa-edit me-1"></i>Update User
                            </button>
                        </div>

                        <div id="user-display" class="user-item">
                            <strong>No user created yet</strong><br>
                            <small class="text-muted">Click "Create User" to start</small>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <!-- DataList Demo -->
                    <div class="collection-demo">
                        <h4><i class="fas fa-users me-2"></i>DataList Demo</h4>
                        <p>Shows collection management, querying, and batch operations</p>

                        <div class="mb-3">
                            <button class="btn btn-custom me-2" onclick="loadUsers()">
                                <i class="fas fa-download me-1"></i>Load Users
                            </button>
                            <button class="btn btn-custom me-2" onclick="filterActive()">
                                <i class="fas fa-filter me-1"></i>Filter Active
                            </button>
                            <button class="btn btn-custom me-2" onclick="sortUsers()">
                                <i class="fas fa-sort me-1"></i>Sort Users
                            </button>
                        </div>

                        <div id="users-display">
                            <div class="text-center text-muted">
                                <i class="fas fa-database fa-2x mb-2"></i><br>
                                No users loaded yet<br>
                                <small>Click "Load Users" to start</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REST API Demo -->
            <div class="demo-section">
                <div class="api-demo">
                    <h4><i class="fas fa-cloud me-2"></i>REST API Client Demo</h4>
                    <p>Demonstrates HTTP client capabilities and API interactions</p>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <button class="btn btn-custom me-2" onclick="testGet()">
                                    <i class="fas fa-download me-1"></i>GET Request
                                </button>
                                <button class="btn btn-custom me-2" onclick="testPost()">
                                    <i class="fas fa-upload me-1"></i>POST Request
                                </button>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-custom me-2" onclick="testPut()">
                                    <i class="fas fa-edit me-1"></i>PUT Request
                                </button>
                                <button class="btn btn-custom me-2" onclick="testDelete()">
                                    <i class="fas fa-trash me-1"></i>DELETE Request
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="console-output" id="api-console">
                                > API Console Ready<br>
                                > Click buttons to test HTTP methods<br>
                                > All requests are simulated for demo
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Code Examples -->
            <div class="demo-section">
                <h4><i class="fas fa-code me-2"></i>Code Examples</h4>
                <div class="row">
                    <div class="col-md-6">
                        <h6>RestModel Usage:</h6>
                        <div class="code-block">// Create and validate user
const user = new User({
    name: 'John Doe',
    email: 'john@example.com'
});

if (user.validate()) {
    await user.save();
}</div>
                    </div>
                    <div class="col-md-6">
                        <h6>DataList Usage:</h6>
                        <div class="code-block">// Load and filter users
const users = new Users();
await users.fetchAll();

const activeUsers = users.getActiveUsers();
console.log(`Found ${activeUsers.length} active users`);</div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-5 mb-4">
                <p class="text-white">
                    <i class="fas fa-rocket me-2"></i>
                    <strong>MOJO Framework v2.0.0</strong> - Phase 2 Data Layer Complete
                </p>
                <p class="text-white-50">
                    <small>RestModel ‚Ä¢ DataList ‚Ä¢ REST Client ‚Ä¢ Validation ‚Ä¢ Events</small>
                </p>
            </div>
        </div>

        <!-- Bootstrap Bundle JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Mustache Template Engine -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.2.0/mustache.min.js"></script>

        <!-- Wait for webpack bundles to load -->
        <script>
            // Wait for MOJO to be available from webpack bundles
            function waitForMOJO(callback) {
                if (typeof MOJO !== 'undefined' && MOJO.RestModel && MOJO.DataList) {
                    callback();
                } else {
                    setTimeout(() => waitForMOJO(callback), 100);
                }
            }

            // Initialize when MOJO is ready
            waitForMOJO(() => {
                initializeMOJODemo();
            });

            function initializeMOJODemo() {
                console.log('üî• MOJO Framework loaded via webpack!');
                console.log('Available:', Object.keys(MOJO));

                // ============================================================================
                // DEMO MODELS AND COLLECTIONS
                // ============================================================================

                // User Model with validation
                class User extends MOJO.RestModel {
                    static endpoint = '/api/users';
                    static validations = {
                        name: { required: true, minLength: 2, maxLength: 50 },
                        email: { required: true, pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
                        age: { type: 'number', min: 13, max: 120 },
                        active: { type: 'boolean', default: true }
                    };

                    getFullName() {
                        return `${this.data.name} (${this.data.email})`;
                    }

                    async activate() {
                        this.data.active = true;
                        return await this.save();
                    }
                }

                // Users Collection
                class Users extends MOJO.DataList {
                    constructor() {
                        super(User);
                        this.endpoint = '/api/users';
                    }

                    getActiveUsers() {
                        return this.filter(user => user.data.active);
                    }

                    async fetchWithPagination(page = 1, limit = 10) {
                        const params = { page, limit };
                        return await this.fetchAll(params);
                    }
                }

                // ============================================================================
                // DEMO STATE AND VARIABLES
                // ============================================================================

                let currentUser = null;
                let userCollection = new Users();
                let apiCallCount = 0;
                let validationCount = 0;

                // Sample user data
                const sampleUsers = [
                    { id: 1, name: 'John Doe', email: 'john@example.com', age: 30, active: true },
                    { id: 2, name: 'Jane Smith', email: 'jane@example.com', age: 25, active: true },
                    { id: 3, name: 'Bob Wilson', email: 'bob@example.com', age: 35, active: false },
                    { id: 4, name: 'Alice Brown', email: 'alice@example.com', age: 28, active: true },
                    { id: 5, name: 'Charlie Davis', email: 'charlie@example.com', age: 42, active: false }
                ];

                // ============================================================================
                // RESTMODEL DEMO FUNCTIONS
                // ============================================================================

                window.createUser = function() {
                    const userData = sampleUsers[Math.floor(Math.random() * sampleUsers.length)];
                    currentUser = new User(userData);

                    updateUserDisplay();
                    updateStats();
                    logToConsole(`‚úÖ Created user: ${currentUser.getFullName()}`);
                };

                window.validateUser = function() {
                    if (!currentUser) {
                        logToConsole('‚ùå No user to validate. Create a user first.');
                        return;
                    }

                    const isValid = currentUser.validate();
                    const errors = currentUser.getValidationErrors();

                    validationCount++;
                    updateStats();

                    if (isValid) {
                        logToConsole('‚úÖ User validation passed');
                    } else {
                        logToConsole(`‚ùå User validation failed: ${JSON.stringify(errors)}`);
                    }
                };

                window.updateUser = function() {
                    if (!currentUser) {
                        logToConsole('‚ùå No user to update. Create a user first.');
                        return;
                    }

                    // Simulate an update
                    const updates = {
                        age: Math.floor(Math.random() * 50) + 20,
                        active: Math.random() > 0.5
                    };

                    Object.assign(currentUser.data, updates);
                    updateUserDisplay();
                    updateStats();

                    logToConsole(`‚úÖ Updated user: ${JSON.stringify(updates)}`);
                };

                // ============================================================================
                // DATALIST DEMO FUNCTIONS
                // ============================================================================

                window.loadUsers = function() {
                    userCollection.clear();

                    // Simulate loading users
                    sampleUsers.forEach(userData => {
                        const user = new User(userData);
                        userCollection.add(user);
                    });

                    apiCallCount++;
                    updateUsersDisplay();
                    updateStats();
                    logToConsole(`‚úÖ Loaded ${userCollection.length} users`);
                };

                window.filterActive = function() {
                    if (userCollection.length === 0) {
                        logToConsole('‚ùå No users to filter. Load users first.');
                        return;
                    }

                    const activeUsers = userCollection.getActiveUsers();
                    displayFilteredUsers(activeUsers, 'Active Users');
                    logToConsole(`‚úÖ Filtered to ${activeUsers.length} active users`);
                };

                window.sortUsers = function() {
                    if (userCollection.length === 0) {
                        logToConsole('‚ùå No users to sort. Load users first.');
                        return;
                    }

                    const sortedUsers = userCollection.sortBy('name');
                    displayFilteredUsers(sortedUsers, 'Sorted Users (by name)');
                    logToConsole(`‚úÖ Sorted ${sortedUsers.length} users by name`);
                };

                // ============================================================================
                // REST API DEMO FUNCTIONS
                // ============================================================================

                window.testGet = function() {
                    apiCallCount++;
                    updateStats();
                    logToApiConsole('GET /api/users - Status: 200 OK');
                    logToApiConsole('Response: [{"id": 1, "name": "John Doe", ...}, ...]');
                };

                window.testPost = function() {
                    apiCallCount++;
                    updateStats();
                    logToApiConsole('POST /api/users - Status: 201 Created');
                    logToApiConsole('Request: {"name": "New User", "email": "new@example.com"}');
                    logToApiConsole('Response: {"id": 6, "name": "New User", ...}');
                };

                window.testPut = function() {
                    apiCallCount++;
                    updateStats();
                    logToApiConsole('PUT /api/users/1 - Status: 200 OK');
                    logToApiConsole('Request: {"name": "Updated User"}');
                    logToApiConsole('Response: {"id": 1, "name": "Updated User", ...}');
                };

                window.testDelete = function() {
                    apiCallCount++;
                    updateStats();
                    logToApiConsole('DELETE /api/users/1 - Status: 204 No Content');
                    logToApiConsole('User successfully deleted');
                };

                // ============================================================================
                // UI UPDATE FUNCTIONS
                // ============================================================================

                function updateUserDisplay() {
                    const display = document.getElementById('user-display');

                    if (currentUser) {
                        const statusClass = currentUser.data.active ? 'user-active' : 'user-inactive';
                        const statusIcon = currentUser.data.active ? 'fas fa-check-circle text-success' : 'fas fa-times-circle text-danger';
                        const statusText = currentUser.data.active ? 'Active' : 'Inactive';

                        display.className = `user-item ${statusClass} fade-in`;
                        display.innerHTML = `
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>${currentUser.data.name}</strong><br>
                                    <small class="text-muted">${currentUser.data.email}</small><br>
                                    <small>Age: ${currentUser.data.age}</small>
                                </div>
                                <div class="text-end">
                                    <i class="${statusIcon} me-1"></i>${statusText}<br>
                                    <small class="text-muted">ID: ${currentUser.data.id}</small>
                                </div>
                            </div>
                        `;
                    }
                }

                function updateUsersDisplay() {
                    displayFilteredUsers(userCollection.items, 'All Users');
                }

                function displayFilteredUsers(users, title) {
                    const display = document.getElementById('users-display');

                    if (users.length === 0) {
                        display.innerHTML = `
                            <div class="text-center text-muted">
                                <i class="fas fa-users fa-2x mb-2"></i><br>
                                No users found<br>
                                <small>${title}</small>
                            </div>
                        `;
                        return;
                    }

                    const usersHtml = users.map(user => {
                        const statusClass = user.data.active ? 'user-active' : 'user-inactive';
                        const statusIcon = user.data.active ? 'fas fa-check-circle text-success' : 'fas fa-times-circle text-danger';
                        const statusText = user.data.active ? 'Active' : 'Inactive';

                        return `
                            <div class="user-item ${statusClass}" style="margin: 5px 0; padding: 15px;">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>${user.data.name}</strong><br>
                                        <small class="text-muted">${user.data.email}</small>
                                    </div>
                                    <div class="text-end">
                                        <i class="${statusIcon}"></i> ${statusText}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    display.innerHTML = `
                        <h6 class="mb-3">${title} (${users.length})</h6>
                        ${usersHtml}
                    `;
                }

                function updateStats() {
                    document.getElementById('user-count').textContent = userCollection.length;
                    document.getElementById('active-count').textContent = userCollection.getActiveUsers().length;
                    document.getElementById('api-calls').textContent = apiCallCount;
                    document.getElementById('validation-checks').textContent = validationCount;
                }

                function logToConsole(message) {
                    console.log(message);
                }

                function logToApiConsole(message) {
                    const console = document.getElementById('api-console');
                    const timestamp = new Date().toLocaleTimeString();
                    console.innerHTML += `<br>[${timestamp}] ${message}`;
                    console.scrollTop = console.scrollHeight;
                }

                // ============================================================================
                // INITIALIZATION
                // ============================================================================

                // Initialize the demo
                console.log('üöÄ Phase 2 Demo initialized successfully!');
                console.log('RestModel:', User);
                console.log('DataList:', Users);

                // Update initial stats
                updateStats();

                // Show success message
                logToApiConsole('MOJO Framework Phase 2 Demo Ready!');
                logToApiConsole('RestModel and DataList components loaded');
                logToApiConsole('Click buttons above to test functionality');
            }
        </script>
    </body>
</html>
