<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MOJO Charts Test</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />
        <style>
            .chart-component {
                border: 1px solid #ddd;
                padding: 1rem;
                margin: 1rem 0;
                border-radius: 0.5rem;
            }
            .status {
                padding: 0.5rem;
                margin: 0.5rem 0;
                border-radius: 0.25rem;
            }
            .status.success {
                background: #d4edda;
                color: #155724;
            }
            .status.error {
                background: #f8d7da;
                color: #721c24;
            }
            .status.info {
                background: #d1ecf1;
                color: #0c5460;
            }
        </style>
    </head>
    <body>
        <div class="container py-4">
            <h1>MOJO Charts Test</h1>
            <p class="text-muted">Testing chart component imports and basic functionality</p>

            <div id="status-log">
                <div class="status info">Starting tests...</div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h3>Series Chart Test</h3>
                    <div id="seriesChartContainer"></div>
                </div>
                <div class="col-md-6">
                    <h3>Pie Chart Test</h3>
                    <div id="pieChartContainer"></div>
                </div>
            </div>
        </div>

        <script type="module">
            const statusLog = document.getElementById("status-log");

            function logStatus(message, type = "info") {
                const div = document.createElement("div");
                div.className = `status ${type}`;
                div.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
                statusLog.appendChild(div);
                console.log(`[${type.toUpperCase()}] ${message}`);
            }

            try {
                logStatus("Attempting to import WebApp...", "info");
                const WebApp = (await import("/src/app/WebApp.js")).default;
                logStatus("WebApp imported successfully", "success");

                logStatus("Attempting to import chart components...", "info");
                const SeriesChart = await import("/src/charts/SeriesChart.js").default;
                const PieChart = await import("/src/charts/PieChart.js").default;
                logStatus("Chart components imported successfully", "success");

                // Test data
                const testData = {
                    series: {
                        labels: ["Jan", "Feb", "Mar", "Apr"],
                        datasets: [
                            {
                                label: "Test Data",
                                data: [10, 20, 15, 25],
                            },
                        ],
                    },
                    pie: [
                        { label: "A", value: 30 },
                        { label: "B", value: 40 },
                        { label: "C", value: 20 },
                        { label: "D", value: 10 },
                    ],
                };

                logStatus("Initializing WebApp...", "info");
                const app = new WebApp();
                await app.start();
                logStatus("WebApp started successfully", "success");

                logStatus("Creating SeriesChart...", "info");
                const seriesChart = new SeriesChart({
                    title: "Test Series Chart",
                    chartType: "line",
                    data: testData.series,
                });

                await seriesChart.render();
                document.getElementById("seriesChartContainer").appendChild(seriesChart.element);
                await seriesChart.mount();
                logStatus("SeriesChart created and mounted successfully", "success");

                logStatus("Creating PieChart...", "info");
                const pieChart = new PieChart({
                    title: "Test Pie Chart",
                    data: testData.pie,
                });

                await pieChart.render();
                document.getElementById("pieChartContainer").appendChild(pieChart.element);
                await pieChart.mount();
                logStatus("PieChart created and mounted successfully", "success");

                logStatus("All tests completed successfully!", "success");
            } catch (error) {
                logStatus(`ERROR: ${error.message}`, "error");
                console.error("Full error:", error);

                // Try to provide more specific error info
                if (error.message.includes("Failed to resolve module")) {
                    logStatus("This appears to be a module resolution issue", "error");
                }
                if (error.message.includes("Chart")) {
                    logStatus("Error seems related to Chart.js or chart components", "error");
                }
            }
        </script>
    </body>
</html>
