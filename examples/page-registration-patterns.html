<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOJO Page Registration Patterns</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .pattern-card {
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .nav-pills .nav-link {
            margin: 5px;
        }
        .instance-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 11px;
        }
        .page-container {
            position: relative;
            min-height: 300px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <span class="navbar-brand">
                <i class="bi bi-file-earmark-code"></i> Page Registration Patterns
            </span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h1>MOJO Page Registration Patterns</h1>
                <p class="lead">Different ways to register pages based on your needs</p>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card pattern-card">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="bi bi-1-circle"></i> Pattern 1: Simple Config Object</h5>
                        <small>Most common - for static or simple dynamic pages</small>
                    </div>
                    <div class="card-body">
                        <div class="code-block">app.registerPage({
  pageName: 'home',
  route: '/home',
  template: '&lt;h1&gt;Welcome Home&lt;/h1&gt;',
  onEnter: async () => {
    console.log('Entered home');
  }
});</div>
                        <p class="text-muted small mt-2">
                            Perfect for simple pages with static content or basic lifecycle hooks.
                        </p>
                    </div>
                </div>

                <div class="card pattern-card">
                    <div class="card-header bg-success text-white">
                        <h5><i class="bi bi-2-circle"></i> Pattern 2: Template Function</h5>
                        <small>For dynamic content generation</small>
                    </div>
                    <div class="card-body">
                        <div class="code-block">app.registerPage({
  pageName: 'users',
  route: '/users',
  getTemplate: async function() {
    const data = await fetchData();
    return generateHTML(data);
  }
});</div>
                        <p class="text-muted small mt-2">
                            Use when you need to fetch data or generate content dynamically.
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card pattern-card">
                    <div class="card-header bg-warning text-white">
                        <h5><i class="bi bi-3-circle"></i> Pattern 3: Custom Page Class</h5>
                        <small>When you need full control and complex logic</small>
                    </div>
                    <div class="card-body">
                        <div class="code-block">class CustomPage extends Page {
  constructor() {
    super({ pageName: 'custom' });
    this.customLogic = true;
  }
  // ... custom methods
}

app.registerPage(CustomPage);</div>
                        <p class="text-muted small mt-2">
                            For complex pages with custom logic, state management, or methods.
                        </p>
                    </div>
                </div>

                <div class="card pattern-card">
                    <div class="card-header bg-info text-white">
                        <h5><i class="bi bi-4-circle"></i> Pattern 4: Class with Options</h5>
                        <small>Reusable classes with configuration</small>
                    </div>
                    <div class="card-body">
                        <div class="code-block">class APIPage extends Page {
  constructor(options) {
    super(options);
    this.apiUrl = options.apiUrl;
  }
}

app.registerPage(APIPage, {
  pageName: 'products',
  apiUrl: '/api/products'
});</div>
                        <p class="text-muted small mt-2">
                            Great for reusable page classes that need different configurations.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <h3>Live Demo</h3>
                <p>Click the buttons below to navigate between pages created with different patterns:</p>

                <ul class="nav nav-pills mb-3">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="simple">
                            <i class="bi bi-1-circle"></i> Simple Config
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="dynamic">
                            <i class="bi bi-2-circle"></i> Dynamic Template
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="custom">
                            <i class="bi bi-3-circle"></i> Custom Class
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="configured">
                            <i class="bi bi-4-circle"></i> Configured Class
                        </a>
                    </li>
                </ul>

                <div class="page-container" id="app">
                    <!-- Pages render here -->
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h5>Key Benefits:</h5>
                    <ul>
                        <li><strong>Simplicity:</strong> Most pages don't need custom classes</li>
                        <li><strong>Flexibility:</strong> Use the right pattern for your needs</li>
                        <li><strong>Performance:</strong> All patterns use the same caching mechanism</li>
                        <li><strong>State Preservation:</strong> Works with all patterns</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import WebApp from '../src/app/WebApp.js';
        import Page from '../src/core/Page.js';

        // Initialize app
        const app = new WebApp({
            name: 'Pattern Demo',
            container: '#app',
            routerMode: 'param'
        });

        // Pattern 1: Simple config object
        app.registerPage({
            pageName: 'simple',
            route: '/simple',
            template: `
                <div>
                    <span class="instance-badge">Pattern 1: Config Object</span>
                    <h2>Simple Page</h2>
                    <p>This page was created from a simple configuration object.</p>
                    <p>No custom class needed - just a template and optional lifecycle hooks.</p>
                    <div class="alert alert-success">
                        <strong>Created at:</strong> ${new Date().toLocaleTimeString()}
                    </div>
                </div>
            `,
            onEnter: async function() {
                console.log('Simple page entered');
            }
        });

        // Pattern 2: Dynamic template function
        app.registerPage({
            pageName: 'dynamic',
            route: '/dynamic',
            getTemplate: async function() {
                // Simulate API call
                const users = [
                    { id: 1, name: 'Alice', role: 'Admin' },
                    { id: 2, name: 'Bob', role: 'User' },
                    { id: 3, name: 'Charlie', role: 'Editor' }
                ];

                return `
                    <div>
                        <span class="instance-badge">Pattern 2: Dynamic Template</span>
                        <h2>Dynamic Users Page</h2>
                        <p>This content was generated dynamically by a template function.</p>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Role</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(user => `
                                    <tr>
                                        <td>${user.id}</td>
                                        <td>${user.name}</td>
                                        <td><span class="badge bg-primary">${user.role}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <small class="text-muted">Generated at: ${new Date().toLocaleTimeString()}</small>
                    </div>
                `;
            }
        });

        // Pattern 3: Custom Page class
        class CustomPage extends Page {
            constructor() {
                super({
                    pageName: 'custom',
                    route: '/custom',
                    displayName: 'Custom Page Class'
                });
                this.clickCount = 0;
                this.instanceId = Math.random().toString(36).substr(2, 9);
            }

            async getTemplate() {
                return `
                    <div>
                        <span class="instance-badge">Pattern 3: Custom Class</span>
                        <h2>${this.displayName}</h2>
                        <p>This page uses a custom Page class with its own methods and state.</p>
                        <div class="alert alert-info">
                            <strong>Instance ID:</strong> ${this.instanceId}<br>
                            <strong>Click Count:</strong> <span id="click-count">${this.clickCount}</span>
                        </div>
                        <button class="btn btn-primary" data-action="increment">
                            Click Me
                        </button>
                        <p class="mt-3">
                            <small>Navigate away and come back - the same instance is reused!</small>
                        </p>
                    </div>
                `;
            }

            async onActionIncrement() {
                this.clickCount++;
                const countEl = this.element.querySelector('#click-count');
                if (countEl) {
                    countEl.textContent = this.clickCount;
                }
            }
        }

        app.registerPage(CustomPage);

        // Pattern 4: Configurable Page class
        class ConfigurablePage extends Page {
            constructor(options = {}) {
                super(options);
                this.color = options.color || 'primary';
                this.icon = options.icon || 'bi-gear';
                this.customData = options.customData || 'No data';
            }

            async getTemplate() {
                return `
                    <div>
                        <span class="instance-badge">Pattern 4: Configured Class</span>
                        <h2><i class="bi ${this.icon}"></i> ${this.displayName}</h2>
                        <p>This page uses a reusable class with constructor options.</p>
                        <div class="alert alert-${this.color}">
                            <strong>Configuration:</strong><br>
                            Color: ${this.color}<br>
                            Icon: ${this.icon}<br>
                            Custom Data: ${this.customData}
                        </div>
                        <p>Same class can be reused with different configurations!</p>
                    </div>
                `;
            }
        }

        app.registerPage(ConfigurablePage, {
            pageName: 'configured',
            route: '/configured',
            displayName: 'Configured Page',
            color: 'warning',
            icon: 'bi-tools',
            customData: 'This data was passed in options!'
        });

        // Add routes
        app.router.addRoute('/simple', 'simple');
        app.router.addRoute('/dynamic', 'dynamic');
        app.router.addRoute('/custom', 'custom');
        app.router.addRoute('/configured', 'configured');

        // Start app
        await app.start();

        // Setup navigation
        document.querySelectorAll('[data-page]').forEach(link => {
            link.addEventListener('click', async (e) => {
                e.preventDefault();
                const pageName = e.currentTarget.dataset.page;

                // Update active state
                document.querySelectorAll('[data-page]').forEach(l => {
                    l.classList.remove('active');
                });
                e.currentTarget.classList.add('active');

                // Navigate
                await app.router.navigateToPage(pageName);
            });
        });

        // Navigate to simple page by default
        await app.router.navigateToPage('simple');
        document.querySelector('[data-page="simple"]').classList.add('active');

        // Make app available for debugging
        window.patternApp = app;

        console.log('Page Registration Patterns Demo Started');
        console.log('Check app.pageClasses to see registered page classes');
        console.log('Check app.pageCache to see cached instances');
    </script>
</body>
</html>
