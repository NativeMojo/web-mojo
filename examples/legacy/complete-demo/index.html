<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MOJO Complete Demo - Multi-page Application</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Bootstrap Icons -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />

        <!-- Import Map for ES Modules -->
        <script type="importmap">
            {
                "imports": {
                    "mustache": "https://cdn.jsdelivr.net/npm/mustache@4.2.0/mustache.mjs"
                }
            }
        </script>
    </head>
    <body class="bg-light">
        <!-- Top Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary py-1">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="#">
                    <i class="bi bi-grid-3x3-gap me-2"></i>
                    MOJO Complete Demo
                </a>

                <div class="navbar-nav">
                    <div class="nav-item dropdown">
                        <a
                            class="nav-link dropdown-toggle"
                            href="#"
                            role="button"
                            data-bs-toggle="dropdown"
                        >
                            <i class="bi bi-gear me-1"></i>
                            Debug
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" href="#" onclick="toggleDebugPanel()">
                                    <i class="bi bi-bug me-2"></i>Toggle Debug Panel
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="clearAllLogs()">
                                    <i class="bi bi-trash me-2"></i>Clear All Logs
                                </a>
                            </li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>
                                <a class="dropdown-item" href="#" onclick="exportDebugData()">
                                    <i class="bi bi-download me-2"></i>Export Debug Data
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar Navigation -->
                <div class="col-md-2 bg-white border-end vh-100 p-2">
                    <div class="d-grid gap-1">
                        <button
                            class="btn btn-sm btn-outline-primary text-start active"
                            onclick="navigateToPage('dashboard')"
                            id="nav-dashboard"
                        >
                            <i class="bi bi-speedometer2 me-2"></i>Dashboard
                        </button>
                        <button
                            class="btn btn-sm btn-outline-primary text-start"
                            onclick="navigateToPage('users')"
                            id="nav-users"
                        >
                            <i class="bi bi-people me-2"></i>Users
                        </button>
                        <button
                            class="btn btn-sm btn-outline-primary text-start"
                            onclick="navigateToPage('reports')"
                            id="nav-reports"
                        >
                            <i class="bi bi-bar-chart me-2"></i>Reports
                        </button>
                        <button
                            class="btn btn-sm btn-outline-primary text-start"
                            onclick="navigateToPage('settings')"
                            id="nav-settings"
                        >
                            <i class="bi bi-sliders me-2"></i>Settings
                        </button>
                    </div>

                    <!-- Navigation Stats -->
                    <div class="mt-3 pt-2 border-top">
                        <h6 class="text-muted small mb-2">Navigation Stats</h6>
                        <table class="table table-sm table-borderless small">
                            <tr>
                                <td class="text-muted">Current Page:</td>
                                <td id="current-page-name">Dashboard</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Page Views:</td>
                                <td id="page-view-count">1</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Route Changes:</td>
                                <td id="route-change-count">0</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Quick Actions -->
                    <div class="mt-3 pt-2 border-top">
                        <h6 class="text-muted small mb-2">Quick Actions</h6>
                        <div class="d-grid gap-1">
                            <button
                                class="btn btn-sm btn-outline-success"
                                onclick="createTestView()"
                            >
                                <i class="bi bi-plus-circle me-1"></i>Test View
                            </button>
                            <button
                                class="btn btn-sm btn-outline-warning"
                                onclick="triggerTestEvent()"
                            >
                                <i class="bi bi-broadcast me-1"></i>Test Event
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="col-md-7 p-2">
                    <!-- Page Header -->
                    <div class="row mb-2">
                        <div class="col">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1" id="page-title">
                                        <i class="bi bi-speedometer2 me-2 text-primary"></i>
                                        Dashboard
                                    </h5>
                                    <p class="text-muted mb-0 small" id="page-description">
                                        Multi-page application with advanced hierarchies and
                                        monitoring
                                    </p>
                                </div>
                                <div>
                                    <span class="badge bg-success" id="connection-status"
                                        >Connected</span
                                    >
                                    <a href="../" class="btn btn-sm btn-outline-secondary ms-2">
                                        <i class="bi bi-arrow-left me-1"></i>Back to Examples
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Page Content -->
                    <div id="page-content">
                        <!-- Content will be dynamically loaded here -->
                    </div>

                    <!-- View Hierarchy Demonstration -->
                    <div class="row mt-3">
                        <div class="col">
                            <div class="card">
                                <div class="card-header py-2">
                                    <h6 class="mb-0">
                                        <i class="bi bi-diagram-3 me-1"></i>
                                        Advanced View Hierarchy Demo
                                    </h6>
                                </div>
                                <div class="card-body p-2">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div
                                                id="parent-view-container"
                                                class="border rounded p-2 bg-light"
                                            >
                                                <!-- Parent view will be rendered here -->
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div
                                                class="btn-group-vertical btn-group-sm d-grid gap-1"
                                            >
                                                <button
                                                    class="btn btn-outline-primary"
                                                    onclick="createParentView()"
                                                >
                                                    <i class="bi bi-plus me-1"></i>Create Parent
                                                    View
                                                </button>
                                                <button
                                                    class="btn btn-outline-success"
                                                    onclick="addChildView()"
                                                >
                                                    <i class="bi bi-node-plus me-1"></i>Add Child
                                                    View
                                                </button>
                                                <button
                                                    class="btn btn-outline-warning"
                                                    onclick="communicateViews()"
                                                >
                                                    <i class="bi bi-arrow-left-right me-1"></i
                                                    >Inter-View Communication
                                                </button>
                                                <button
                                                    class="btn btn-outline-danger"
                                                    onclick="clearHierarchy()"
                                                >
                                                    <i class="bi bi-trash me-1"></i>Clear Hierarchy
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar: Debug & Monitoring -->
                <div class="col-md-3 p-2">
                    <!-- Debug Panel -->
                    <div class="card mb-2" id="debug-panel">
                        <div class="card-header py-2 bg-dark text-white">
                            <h6 class="mb-0">
                                <i class="bi bi-bug me-1"></i>
                                Debug Panel
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <!-- Framework Stats -->
                            <h6 class="small text-muted mb-1">Framework Statistics</h6>
                            <table class="table table-sm table-borderless mb-2 small">
                                <tr>
                                    <td>Version:</td>
                                    <td id="framework-version">2.0.0</td>
                                </tr>
                                <tr>
                                    <td>Views Active:</td>
                                    <td id="active-views-count">0</td>
                                </tr>
                                <tr>
                                    <td>Pages Loaded:</td>
                                    <td id="loaded-pages-count">0</td>
                                </tr>
                                <tr>
                                    <td>Event Count:</td>
                                    <td id="total-events-count">0</td>
                                </tr>
                            </table>

                            <!-- Performance Monitor -->
                            <h6 class="small text-muted mb-1">Performance</h6>
                            <div class="progress mb-1" style="height: 8px">
                                <div
                                    class="progress-bar bg-success"
                                    id="memory-usage"
                                    style="width: 25%"
                                ></div>
                            </div>
                            <div class="d-flex justify-content-between small text-muted mb-2">
                                <span>Memory</span>
                                <span id="memory-percentage">25%</span>
                            </div>

                            <!-- Debug Actions -->
                            <div class="d-grid gap-1">
                                <button
                                    class="btn btn-sm btn-outline-info"
                                    onclick="inspectFramework()"
                                >
                                    <i class="bi bi-search me-1"></i>Inspect
                                </button>
                                <button
                                    class="btn btn-sm btn-outline-warning"
                                    onclick="showHierarchy()"
                                >
                                    <i class="bi bi-diagram-2 me-1"></i>View Tree
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Activity Monitor -->
                    <div class="card mb-2">
                        <div class="card-header py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="bi bi-activity me-1"></i>
                                    Activity Monitor
                                </h6>
                                <div class="form-check form-switch">
                                    <input
                                        class="form-check-input"
                                        type="checkbox"
                                        id="auto-scroll"
                                        checked
                                    />
                                    <label class="form-check-label small" for="auto-scroll"
                                        >Auto</label
                                    >
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div
                                id="activity-log"
                                class="small"
                                style="height: 200px; overflow-y: auto"
                            >
                                <div class="p-2 text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Waiting for activity...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Event Bus Monitor -->
                    <div class="card">
                        <div class="card-header py-2">
                            <h6 class="mb-0">
                                <i class="bi bi-broadcast me-1"></i>
                                Event Bus
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="row text-center small">
                                <div class="col-4">
                                    <div class="bg-primary text-white py-1 rounded">
                                        <div id="events-emitted">0</div>
                                        <div class="small">Emitted</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="bg-success text-white py-1 rounded">
                                        <div id="events-handled">0</div>
                                        <div class="small">Handled</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="bg-info text-white py-1 rounded">
                                        <div id="listeners-active">0</div>
                                        <div class="small">Listeners</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Events -->
                            <h6 class="small text-muted mt-2 mb-1">Recent Events</h6>
                            <div id="recent-events" class="small">
                                <div class="text-muted">No events yet</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Application Logic -->
        <script type="module">
            import MOJO, { View, Page } from "../../src/mojo.js";

            // Application state
            let mojoInstance = null;
            let currentPage = "dashboard";
            let pageViewCount = 1;
            let routeChangeCount = 0;
            let eventsEmitted = 0;
            let eventsHandled = 0;
            let activeViews = [];
            let hierarchyViews = [];

            // Monitoring utilities
            function logActivity(message, type = "info", source = "System") {
                const log = document.getElementById("activity-log");
                const timestamp = new Date().toLocaleTimeString();
                const icons = {
                    info: "info-circle",
                    success: "check-circle",
                    warning: "exclamation-triangle",
                    error: "x-circle",
                    event: "broadcast",
                };
                const colors = {
                    info: "text-info",
                    success: "text-success",
                    warning: "text-warning",
                    error: "text-danger",
                    event: "text-primary",
                };

                const entry = document.createElement("div");
                entry.className = "p-2 border-bottom bg-white";
                entry.innerHTML = `
                    <div class="d-flex align-items-start">
                        <i class="bi bi-${icons[type]} me-2 ${colors[type]} mt-1"></i>
                        <div class="flex-grow-1">
                            <div class="small">${message}</div>
                            <div class="text-muted" style="font-size: 0.75rem;">
                                ${timestamp} • ${source}
                            </div>
                        </div>
                    </div>
                `;

                log.appendChild(entry);

                // Auto scroll if enabled
                if (document.getElementById("auto-scroll").checked) {
                    log.scrollTop = log.scrollHeight;
                }

                // Keep only last 50 entries
                while (log.children.length > 50) {
                    log.removeChild(log.firstChild);
                }
            }

            function updateStats() {
                document.getElementById("active-views-count").textContent = activeViews.length;
                document.getElementById("loaded-pages-count").textContent =
                    Object.keys(pages).length;
                document.getElementById("total-events-count").textContent = eventsEmitted;
                document.getElementById("page-view-count").textContent = pageViewCount;
                document.getElementById("route-change-count").textContent = routeChangeCount;
                document.getElementById("events-emitted").textContent = eventsEmitted;
                document.getElementById("events-handled").textContent = eventsHandled;

                // Simulate memory usage
                const memoryUsage = Math.min(95, 25 + activeViews.length * 5 + eventsEmitted * 0.1);
                document.getElementById("memory-usage").style.width = memoryUsage + "%";
                document.getElementById("memory-percentage").textContent =
                    Math.round(memoryUsage) + "%";
            }

            function addRecentEvent(eventName, data) {
                const container = document.getElementById("recent-events");
                const timestamp = new Date().toLocaleTimeString();

                const eventEntry = document.createElement("div");
                eventEntry.className = "mb-1 p-1 bg-light rounded";
                eventEntry.innerHTML = `
                    <div class="fw-bold">${eventName}</div>
                    <div class="text-muted" style="font-size: 0.75rem;">${timestamp}</div>
                `;

                container.appendChild(eventEntry);

                // Keep only last 5 events
                while (container.children.length > 5) {
                    container.removeChild(container.firstChild);
                }
            }

            // Page definitions
            class DashboardPage extends Page {
                constructor() {
                    super({
                        page_name: "dashboard",
                        route: "/",
                        template: `
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <div class="card">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-2">
                                                <i class="bi bi-graph-up me-1 text-success"></i>
                                                System Overview
                                            </h6>
                                            <div class="row text-center">
                                                <div class="col-4">
                                                    <div class="bg-primary text-white py-2 rounded">
                                                        <div class="fs-5 fw-bold">{{totalUsers}}</div>
                                                        <div class="small">Total Users</div>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="bg-success text-white py-2 rounded">
                                                        <div class="fs-5 fw-bold">{{activeUsers}}</div>
                                                        <div class="small">Active</div>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="bg-info text-white py-2 rounded">
                                                        <div class="fs-5 fw-bold">{{newToday}}</div>
                                                        <div class="small">New Today</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <div class="card">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-2">
                                                <i class="bi bi-speedometer2 me-1 text-warning"></i>
                                                Performance Metrics
                                            </h6>
                                            <table class="table table-sm table-borderless mb-0">
                                                <tr>
                                                    <td>Response Time:</td>
                                                    <td class="text-end text-success fw-bold">{{responseTime}}ms</td>
                                                </tr>
                                                <tr>
                                                    <td>CPU Usage:</td>
                                                    <td class="text-end">{{cpuUsage}}%</td>
                                                </tr>
                                                <tr>
                                                    <td>Memory Usage:</td>
                                                    <td class="text-end">{{memoryUsage}}%</td>
                                                </tr>
                                                <tr>
                                                    <td>Active Connections:</td>
                                                    <td class="text-end fw-bold">{{activeConnections}}</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body p-2">
                                            <h6 class="card-title mb-2">
                                                <i class="bi bi-activity me-1 text-primary"></i>
                                                Quick Actions
                                            </h6>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button class="btn btn-outline-primary" data-action="click:refreshData">
                                                    <i class="bi bi-arrow-clockwise me-1"></i>Refresh Data
                                                </button>
                                                <button class="btn btn-outline-success" data-action="click:generateReport">
                                                    <i class="bi bi-file-earmark-text me-1"></i>Generate Report
                                                </button>
                                                <button class="btn btn-outline-info" data-action="click:viewAnalytics">
                                                    <i class="bi bi-graph-up me-1"></i>View Analytics
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        data: {
                            totalUsers: 1247,
                            activeUsers: 892,
                            newToday: 23,
                            responseTime: 145,
                            cpuUsage: 23,
                            memoryUsage: 67,
                            activeConnections: 156,
                        },
                    });
                }

                async onActionRefreshData() {
                    logActivity("Dashboard data refreshed", "success", "Dashboard");
                    // Simulate data update
                    this.data.totalUsers += Math.floor(Math.random() * 10);
                    this.data.activeUsers += Math.floor(Math.random() * 5);
                    this.render();
                }

                async onActionGenerateReport() {
                    logActivity("Report generation started", "info", "Dashboard");
                    setTimeout(() => {
                        logActivity("Report generated successfully", "success", "Dashboard");
                    }, 2000);
                }

                async onActionViewAnalytics() {
                    logActivity("Analytics view opened", "info", "Dashboard");
                    navigateToPage("reports");
                }
            }

            class UsersPage extends Page {
                constructor() {
                    super({
                        page_name: "users",
                        route: "/users",
                        template: `
                            <div class="card">
                                <div class="card-header py-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <i class="bi bi-people me-1"></i>
                                            User Management
                                        </h6>
                                        <button class="btn btn-sm btn-primary" data-action="click:addUser">
                                            <i class="bi bi-person-plus me-1"></i>Add User
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body p-2">
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th style="width: 5%">#</th>
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th style="width: 15%">Status</th>
                                                    <th style="width: 20%">Last Login</th>
                                                    <th style="width: 15%">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {{#users}}
                                                <tr>
                                                    <td>{{id}}</td>
                                                    <td><strong>{{name}}</strong></td>
                                                    <td>{{email}}</td>
                                                    <td>
                                                        <span class="badge {{#active}}bg-success{{/active}}{{^active}}bg-secondary{{/active}}">
                                                            {{#active}}Active{{/active}}{{^active}}Inactive{{/active}}
                                                        </span>
                                                    </td>
                                                    <td class="small text-muted">{{lastLogin}}</td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm">
                                                            <button class="btn btn-outline-primary btn-sm">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                            <button class="btn btn-outline-danger btn-sm">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {{/users}}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        `,
                        data: {
                            users: [
                                {
                                    id: 1,
                                    name: "John Doe",
                                    email: "john@example.com",
                                    active: true,
                                    lastLogin: "2 hours ago",
                                },
                                {
                                    id: 2,
                                    name: "Jane Smith",
                                    email: "jane@example.com",
                                    active: true,
                                    lastLogin: "1 day ago",
                                },
                                {
                                    id: 3,
                                    name: "Bob Wilson",
                                    email: "bob@example.com",
                                    active: false,
                                    lastLogin: "1 week ago",
                                },
                                {
                                    id: 4,
                                    name: "Alice Brown",
                                    email: "alice@example.com",
                                    active: true,
                                    lastLogin: "5 minutes ago",
                                },
                            ],
                        },
                    });
                }

                async onActionAddUser() {
                    logActivity("Add user dialog opened", "info", "Users");
                    const newUser = {
                        id: this.data.users.length + 1,
                        name: "New User",
                        email: `user${this.data.users.length + 1}@example.com`,
                        active: true,
                        lastLogin: "Just now",
                    };
                    this.data.users.push(newUser);
                    this.render();
                    logActivity(`User "${newUser.name}" added successfully`, "success", "Users");
                }
            }

            class ReportsPage extends Page {
                constructor() {
                    super({
                        page_name: "reports",
                        route: "/reports",
                        template: `
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header py-2">
                                            <h6 class="mb-0">
                                                <i class="bi bi-bar-chart me-1"></i>
                                                System Reports & Analytics
                                            </h6>
                                        </div>
                                        <div class="card-body p-2">
                                            <div class="row">
                                                <div class="col-md-6 mb-2">
                                                    <div class="card">
                                                        <div class="card-body p-2 text-center">
                                                            <h6 class="text-primary">Daily Active Users</h6>
                                                            <div class="fs-3 fw-bold text-primary">{{dailyActive}}</div>
                                                            <small class="text-muted">↑ 12% from yesterday</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-2">
                                                    <div class="card">
                                                        <div class="card-body p-2 text-center">
                                                            <h6 class="text-success">Revenue</h6>
                                                            <div class="fs-3 fw-bold text-success">{{revenue}}</div>
                                                            <small class="text-muted">↑ 8% from last week</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="alert alert-info py-2">
                                                <h6 class="alert-heading mb-1">
                                                    <i class="bi bi-info-circle me-1"></i>
                                                    Analytics Summary
                                                </h6>
                                                <p class="mb-0 small">
                                                    Performance metrics show consistent growth across all key indicators.
                                                    User engagement is up 15% this month with improved retention rates.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header py-2">
                                            <h6 class="mb-0">Export Options</h6>
                                        </div>
                                        <div class="card-body p-2">
                                            <div class="d-grid gap-1">
                                                <button class="btn btn-sm btn-outline-primary" data-action="click:exportPDF">
                                                    <i class="bi bi-file-earmark-pdf me-1"></i>Export PDF
                                                </button>
                                                <button class="btn btn-sm btn-outline-success" data-action="click:exportExcel">
                                                    <i class="bi bi-file-earmark-excel me-1"></i>Export Excel
                                                </button>
                                                <button class="btn btn-sm btn-outline-info" data-action="click:exportCSV">
                                                    <i class="bi bi-file-earmark-text me-1"></i>Export CSV
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        data: {
                            dailyActive: 892,
                            revenue: "$12,847",
                        },
                    });
                }

                async onActionExportPDF() {
                    logActivity("PDF export started", "info", "Reports");
                }

                async onActionExportExcel() {
                    logActivity("Excel export started", "info", "Reports");
                }

                async onActionExportCSV() {
                    logActivity("CSV export started", "info", "Reports");
                }
            }

            class SettingsPage extends Page {
                constructor() {
                    super({
                        page_name: "settings",
                        route: "/settings",
                        template: `
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header py-2">
                                            <h6 class="mb-0">
                                                <i class="bi bi-gear me-1"></i>
                                                Application Settings
                                            </h6>
                                        </div>
                                        <div class="card-body p-2">
                                            <div class="form-check form-switch mb-2">
                                                <input class="form-check-input" type="checkbox" id="debugMode" {{#debugEnabled}}checked{{/debugEnabled}}>
                                                <label class="form-check-label" for="debugMode">
                                                    Enable Debug Mode
                                                </label>
                                            </div>
                                            <div class="form-check form-switch mb-2">
                                                <input class="form-check-input" type="checkbox" id="autoRefresh" {{#autoRefresh}}checked{{/autoRefresh}}>
                                                <label class="form-check-label" for="autoRefresh">
                                                    Auto-refresh Data
                                                </label>
                                            </div>
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="notifications" {{#notifications}}checked{{/notifications}}>
                                                <label class="form-check-label" for="notifications">
                                                    Enable Notifications
                                                </label>
                                            </div>
                                            <button class="btn btn-sm btn-primary" data-action="click:saveSettings">
                                                <i class="bi bi-check me-1"></i>Save Settings
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header py-2">
                                            <h6 class="mb-0">
                                                <i class="bi bi-info-circle me-1"></i>
                                                Framework Information
                                            </h6>
                                        </div>
                                        <div class="card-body p-2">
                                            <table class="table table-sm table-borderless">
                                                <tr>
                                                    <td class="text-muted">Version:</td>
                                                    <td>{{version}}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">Build:</td>
                                                    <td>{{build}}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">Environment:</td>
                                                    <td><span class="badge bg-warning">{{environment}}</span></td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">Uptime:</td>
                                                    <td>{{uptime}}</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        data: {
                            debugEnabled: true,
                            autoRefresh: false,
                            notifications: true,
                            version: "2.0.0",
                            build: "2024.01.15",
                            environment: "Development",
                            uptime: "2h 34m",
                        },
                    });
                }

                async onActionSaveSettings() {
                    logActivity("Settings saved successfully", "success", "Settings");
                }
            }

            // Page registry
            const pages = {
                dashboard: new DashboardPage(),
                users: new UsersPage(),
                reports: new ReportsPage(),
                settings: new SettingsPage(),
            };

            // Advanced View Hierarchy Classes
            class ParentView extends View {
                constructor(options = {}) {
                    super({
                        template: `
                            <div class="border rounded p-2 mb-2">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0 text-primary">
                                        <i class="bi bi-diagram-2 me-1"></i>
                                        Parent View ({{name}})
                                    </h6>
                                    <span class="badge bg-primary">{{children.length}} children</span>
                                </div>
                                <div class="text-muted small mb-2">
                                    {{description}}
                                </div>
                                <div id="children-container-{{id}}" class="ms-3">
                                    <!-- Child views will be rendered here -->
                                </div>
                                <button class="btn btn-sm btn-outline-success" data-action="click:addChild">
                                    <i class="bi bi-plus-circle me-1"></i>Add Child
                                </button>
                                <button class="btn btn-sm btn-outline-info ms-1" data-action="click:broadcastMessage">
                                    <i class="bi bi-broadcast me-1"></i>Broadcast
                                </button>
                            </div>
                        `,
                        data: {
                            id: Math.random().toString(36).substr(2, 9),
                            name: "Primary Parent",
                            description:
                                "This is a parent view that can contain child views and manage communication.",
                            children: [],
                        },
                        ...options,
                    });
                }

                async onActionAddChild() {
                    const childId = Math.random().toString(36).substr(2, 9);
                    const child = new ChildView({
                        container: `#children-container-${this.data.id}`,
                        data: {
                            id: childId,
                            parentId: this.data.id,
                            name: `Child ${this.data.children.length + 1}`,
                            message: "I am a child view",
                        },
                    });

                    this.data.children.push(child);
                    activeViews.push(child);

                    await child.render();
                    this.render(); // Update parent to show new child count

                    logActivity(
                        `Child view "${child.data.name}" added to parent "${this.data.name}"`,
                        "success",
                        "Hierarchy",
                    );
                    updateStats();
                }

                async onActionBroadcastMessage() {
                    const message = `Broadcast from ${this.data.name} at ${new Date().toLocaleTimeString()}`;

                    if (mojoInstance && mojoInstance.eventBus) {
                        mojoInstance.eventBus.emit("parent:broadcast", {
                            parentId: this.data.id,
                            message: message,
                            timestamp: Date.now(),
                        });
                    }

                    logActivity(`Broadcast message sent: "${message}"`, "event", "Hierarchy");
                    eventsEmitted++;
                    addRecentEvent("parent:broadcast", { message });
                    updateStats();
                }
            }

            class ChildView extends View {
                constructor(options = {}) {
                    super({
                        template: `
                            <div class="border rounded p-2 mb-1 bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-0 text-success">
                                            <i class="bi bi-circle-fill me-1" style="font-size: 0.5rem;"></i>
                                            {{name}}
                                        </h6>
                                        <div class="small text-muted">{{message}}</div>
                                    </div>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-warning" data-action="click:sendToParent">
                                            <i class="bi bi-arrow-up"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" data-action="click:remove">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `,
                        ...options,
                    });

                    // Listen for parent broadcasts
                    if (mojoInstance && mojoInstance.eventBus) {
                        mojoInstance.eventBus.on("parent:broadcast", (data) => {
                            if (data.parentId === this.data.parentId) {
                                this.data.message = `Received: ${data.message}`;
                                this.render();
                                eventsHandled++;
                                updateStats();
                            }
                        });
                    }
                }

                async onActionSendToParent() {
                    const message = `Message from ${this.data.name}`;

                    if (mojoInstance && mojoInstance.eventBus) {
                        mojoInstance.eventBus.emit("child:message", {
                            childId: this.data.id,
                            parentId: this.data.parentId,
                            message: message,
                            timestamp: Date.now(),
                        });
                    }

                    logActivity(`Child message sent: "${message}"`, "event", "Hierarchy");
                    eventsEmitted++;
                    addRecentEvent("child:message", { message });
                    updateStats();
                }

                async onActionRemove() {
                    if (this.container) {
                        this.container.remove();
                    }

                    // Remove from activeViews
                    const index = activeViews.indexOf(this);
                    if (index > -1) {
                        activeViews.splice(index, 1);
                    }

                    logActivity(`Child view "${this.data.name}" removed`, "warning", "Hierarchy");
                    updateStats();
                }
            }

            // Global functions
            window.navigateToPage = function (pageName) {
                if (!pages[pageName]) return;

                // Update navigation state
                document.querySelectorAll('[id^="nav-"]').forEach((btn) => {
                    btn.classList.remove("active");
                });
                document.getElementById(`nav-${pageName}`).classList.add("active");

                // Update page info
                currentPage = pageName;
                if (pageName !== "dashboard") {
                    pageViewCount++;
                    routeChangeCount++;
                }

                const pageInfo = {
                    dashboard: {
                        title: "Dashboard",
                        icon: "speedometer2",
                        desc: "System overview and quick actions",
                    },
                    users: {
                        title: "Users",
                        icon: "people",
                        desc: "User management and administration",
                    },
                    reports: {
                        title: "Reports",
                        icon: "bar-chart",
                        desc: "Analytics and reporting tools",
                    },
                    settings: {
                        title: "Settings",
                        icon: "sliders",
                        desc: "Application configuration and preferences",
                    },
                };

                const info = pageInfo[pageName];
                document.getElementById("page-title").innerHTML = `
                    <i class="bi bi-${info.icon} me-2 text-primary"></i>
                    ${info.title}
                `;
                document.getElementById("page-description").textContent = info.desc;
                document.getElementById("current-page-name").textContent = info.title;

                // Render page content
                const page = pages[pageName];
                page.container = document.getElementById("page-content");
                page.render();

                logActivity(`Navigated to ${info.title} page`, "info", "Navigation");
                updateStats();

                // Simulate route change if router exists
                if (mojoInstance && mojoInstance.router) {
                    mojoInstance.router.navigate(page.route);
                }
            };

            window.toggleDebugPanel = function () {
                const panel = document.getElementById("debug-panel");
                panel.style.display = panel.style.display === "none" ? "block" : "none";
                logActivity("Debug panel toggled", "info", "Debug");
            };

            window.clearAllLogs = function () {
                document.getElementById("activity-log").innerHTML = `
                    <div class="p-2 text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        Activity log cleared
                    </div>
                `;
                document.getElementById("recent-events").innerHTML =
                    '<div class="text-muted">No events</div>';
                logActivity("All logs cleared", "warning", "Debug");
            };

            window.exportDebugData = function () {
                const data = {
                    timestamp: new Date().toISOString(),
                    stats: {
                        activeViews: activeViews.length,
                        currentPage: currentPage,
                        pageViews: pageViewCount,
                        routeChanges: routeChangeCount,
                        eventsEmitted: eventsEmitted,
                        eventsHandled: eventsHandled,
                    },
                    framework: {
                        version: "2.0.0",
                        debug: true,
                    },
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: "application/json",
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `mojo-debug-${Date.now()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                logActivity("Debug data exported successfully", "success", "Debug");
            };

            window.createParentView = function () {
                const parentView = new ParentView({
                    container: "#parent-view-container",
                });

                hierarchyViews.push(parentView);
                activeViews.push(parentView);

                parentView.render();
                logActivity("Parent view created", "success", "Hierarchy");
                updateStats();
            };

            window.addChildView = function () {
                if (hierarchyViews.length === 0) {
                    logActivity(
                        "No parent view exists. Create a parent view first.",
                        "warning",
                        "Hierarchy",
                    );
                    return;
                }

                const parent = hierarchyViews[hierarchyViews.length - 1];
                parent.onActionAddChild();
            };

            window.communicateViews = function () {
                if (hierarchyViews.length === 0) {
                    logActivity("No views exist for communication test", "warning", "Hierarchy");
                    return;
                }

                const parent = hierarchyViews[hierarchyViews.length - 1];
                parent.onActionBroadcastMessage();
            };

            window.clearHierarchy = function () {
                document.getElementById("parent-view-container").innerHTML = "";
                hierarchyViews.length = 0;
                activeViews.length = 0;
                logActivity("View hierarchy cleared", "warning", "Hierarchy");
                updateStats();
            };

            window.createTestView = function () {
                const testView = new View({
                    container: "#parent-view-container",
                    template: `
                        <div class="alert alert-success py-2 mb-2">
                            <i class="bi bi-check-circle me-1"></i>
                            Test view created at {{timestamp}}
                        </div>
                    `,
                    data: {
                        timestamp: new Date().toLocaleTimeString(),
                    },
                });

                testView.render();
                activeViews.push(testView);
                logActivity("Test view created", "success", "Debug");
                updateStats();
            };

            window.triggerTestEvent = function () {
                if (mojoInstance && mojoInstance.eventBus) {
                    const eventData = {
                        test: true,
                        timestamp: Date.now(),
                        random: Math.random(),
                    };

                    mojoInstance.eventBus.emit("test:event", eventData);
                    eventsEmitted++;
                    addRecentEvent("test:event", eventData);
                    updateStats();
                    logActivity("Test event emitted", "event", "Debug");
                }
            };

            window.inspectFramework = function () {
                console.group("🔍 MOJO Framework Inspection");
                console.log("Instance:", mojoInstance);
                console.log("Active Views:", activeViews);
                console.log("Loaded Pages:", pages);
                console.log("Current Page:", currentPage);
                console.log("Event Stats:", { emitted: eventsEmitted, handled: eventsHandled });
                console.groupEnd();

                logActivity("Framework inspection data logged to console", "info", "Debug");
            };

            window.showHierarchy = function () {
                if (typeof MOJODevTools !== "undefined") {
                    const hierarchy = MOJODevTools.hierarchy();
                    console.log("MOJO View Hierarchy:", hierarchy);
                    logActivity("View hierarchy logged to console", "info", "Debug");
                } else {
                    console.log("MOJODevTools not available");
                    logActivity(
                        "MOJODevTools not available for hierarchy inspection",
                        "warning",
                        "Debug",
                    );
                }
            };

            // Initialize Application
            async function initializeApp() {
                try {
                    logActivity("Initializing MOJO Complete Demo...", "info", "System");

                    // Create MOJO instance
                    mojoInstance = MOJO.create({
                        container: "#page-content",
                        debug: true,
                    });

                    // Register all pages
                    Object.values(pages).forEach((page) => {
                        mojoInstance.addPage(page);
                    });

                    // Set up global event listeners
                    mojoInstance.eventBus.on("*", (data, eventName) => {
                        if (!eventName.startsWith("mojo:")) {
                            eventsHandled++;
                            updateStats();
                        }
                    });

                    mojoInstance.eventBus.on("child:message", (data) => {
                        logActivity(
                            `Received child message: ${data.message}`,
                            "event",
                            "Hierarchy",
                        );
                    });

                    // Start the application
                    await mojoInstance.start();

                    // Load initial page
                    navigateToPage("dashboard");

                    // Update connection status
                    document.getElementById("connection-status").textContent = "Connected";
                    document.getElementById("connection-status").className = "badge bg-success";

                    // Set up periodic stats update
                    setInterval(() => {
                        updateStats();
                    }, 5000);

                    logActivity(
                        "MOJO Complete Demo initialized successfully!",
                        "success",
                        "System",
                    );
                } catch (error) {
                    logActivity(`Initialization failed: ${error.message}`, "error", "System");
                    document.getElementById("connection-status").textContent = "Error";
                    document.getElementById("connection-status").className = "badge bg-danger";
                }
            }

            // Start the application
            document.addEventListener("DOMContentLoaded", initializeApp);

            // Console welcome
            console.log(`
🎯 MOJO Complete Demo Application Loaded
📚 Features:
  - Multi-page navigation system
  - Advanced view hierarchies
  - Real-time monitoring and debug panel
  - Inter-view communication
  - Event bus demonstration
  - Performance tracking

🛠️ Available Functions:
  - navigateToPage(pageName) : Navigate between pages
  - createParentView() : Create hierarchical parent view
  - addChildView() : Add child to existing parent
  - communicateViews() : Test inter-view communication
  - clearHierarchy() : Clear all hierarchy views
  - inspectFramework() : Log framework state to console
  - toggleDebugPanel() : Show/hide debug panel

🔧 Open browser DevTools to explore!
            `);
        </script>
    </body>
</html>
