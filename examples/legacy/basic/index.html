<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MOJO Basic Example</title>

        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <!-- Bootstrap Icons -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />

        <!-- Import Map for ES Modules -->
        <script type="importmap">
            {
                "imports": {
                    "mustache": "https://cdn.jsdelivr.net/npm/mustache@4.2.0/mustache.mjs"
                }
            }
        </script>
    </head>
    <body class="bg-light">
        <div class="container-fluid py-2">
            <!-- Header -->
            <div class="row mb-2">
                <div class="col">
                    <h5 class="mb-1">
                        <i class="bi bi-play-circle me-2 text-primary"></i>
                        MOJO Basic Example
                    </h5>
                    <p class="text-muted mb-0 small">
                        Foundation concepts: Views, Pages, Templates, Events
                    </p>
                </div>
                <div class="col-auto">
                    <a href="../" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>
                        Back to Examples
                    </a>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mb-2">
                <div class="col-auto">
                    <small class="text-muted">Status:</small>
                    <span class="badge bg-warning" id="status-badge">Loading...</span>
                </div>
                <div class="col-auto">
                    <small class="text-muted">Views:</small>
                    <span class="badge bg-info" id="views-count">0</span>
                </div>
                <div class="col-auto">
                    <small class="text-muted">Events:</small>
                    <span class="badge bg-success" id="events-count">0</span>
                </div>
            </div>

            <div class="row">
                <!-- Main Content -->
                <div class="col-lg-8">
                    <!-- Application Container -->
                    <div class="card mb-2">
                        <div class="card-header py-2">
                            <h6 class="mb-0">
                                <i class="bi bi-app me-1"></i>
                                Application Output
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <div id="app">
                                <div class="text-center py-3">
                                    <div
                                        class="spinner-border spinner-border-sm me-2"
                                        role="status"
                                    ></div>
                                    <small class="text-muted">Initializing MOJO Framework...</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Demo -->
                    <div class="card mb-2">
                        <div class="card-header py-2">
                            <h6 class="mb-0">
                                <i class="bi bi-compass me-1"></i>
                                Navigation Demo
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="btn-group btn-group-sm" role="group">
                                <button
                                    class="btn btn-outline-primary"
                                    onclick="navigateTo('home')"
                                >
                                    <i class="bi bi-house me-1"></i>Home
                                </button>
                                <button
                                    class="btn btn-outline-primary"
                                    onclick="navigateTo('about')"
                                >
                                    <i class="bi bi-info-circle me-1"></i>About
                                </button>
                                <button
                                    class="btn btn-outline-primary"
                                    onclick="navigateTo('contact')"
                                >
                                    <i class="bi bi-envelope me-1"></i>Contact
                                </button>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">Current Route:</small>
                                <code class="bg-light px-1 rounded" id="current-route">-</code>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Actions Panel -->
                    <div class="card mb-2">
                        <div class="card-header py-2">
                            <h6 class="mb-0">
                                <i class="bi bi-lightning me-1"></i>
                                Actions
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <div class="d-grid gap-1">
                                <button class="btn btn-sm btn-primary" onclick="createView()">
                                    <i class="bi bi-plus-circle me-1"></i>Create View
                                </button>
                                <button class="btn btn-sm btn-success" onclick="updateView()">
                                    <i class="bi bi-arrow-clockwise me-1"></i>Update View
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="testEvents()">
                                    <i class="bi bi-broadcast me-1"></i>Test Events
                                </button>
                                <button class="btn btn-sm btn-info" onclick="showHierarchy()">
                                    <i class="bi bi-diagram-3 me-1"></i>Show Hierarchy
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Event Log -->
                    <div class="card mb-2">
                        <div
                            class="card-header py-2 d-flex justify-content-between align-items-center"
                        >
                            <h6 class="mb-0">
                                <i class="bi bi-journal-text me-1"></i>
                                Event Log
                            </h6>
                            <button class="btn btn-sm btn-link p-0" onclick="clearLog()">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div
                                id="event-log"
                                class="small"
                                style="max-height: 200px; overflow-y: auto"
                            >
                                <div class="p-2 text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Events will appear here...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Framework Info -->
                    <div class="card">
                        <div class="card-header py-2">
                            <h6 class="mb-0">
                                <i class="bi bi-gear me-1"></i>
                                Framework Info
                            </h6>
                        </div>
                        <div class="card-body p-2">
                            <table class="table table-sm table-borderless mb-0">
                                <tr>
                                    <td class="text-muted small">Version:</td>
                                    <td class="small" id="framework-version">-</td>
                                </tr>
                                <tr>
                                    <td class="text-muted small">Debug:</td>
                                    <td class="small" id="framework-debug">-</td>
                                </tr>
                                <tr>
                                    <td class="text-muted small">Container:</td>
                                    <td class="small">#app</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learning Notes -->
            <div class="row mt-2">
                <div class="col">
                    <div class="alert alert-info py-2 mb-2">
                        <h6 class="alert-heading mb-1">
                            <i class="bi bi-lightbulb me-1"></i>
                            Learning Notes
                        </h6>
                        <p class="mb-1 small">
                            This example demonstrates MOJO's core concepts: View creation, lifecycle
                            management, event handling, and page navigation.
                        </p>
                        <ul class="mb-0 small">
                            <li>Views are created with templates and data</li>
                            <li>Pages handle routing and navigation</li>
                            <li>Events enable component communication</li>
                            <li>All interactions are logged for learning</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Application Logic -->
        <script type="module">
            import MOJO, { View, Page } from "../../src/mojo.js";

            // State tracking
            let eventCount = 0;
            let viewCount = 0;
            let mojoInstance = null;

            // Utility functions for UI updates
            function updateStats() {
                document.getElementById("views-count").textContent = viewCount;
                document.getElementById("events-count").textContent = eventCount;
            }

            function logEvent(message, type = "info") {
                eventCount++;
                const log = document.getElementById("event-log");
                const timestamp = new Date().toLocaleTimeString();
                const iconMap = {
                    info: "info-circle",
                    success: "check-circle",
                    warning: "exclamation-triangle",
                    error: "x-circle",
                };
                const colorMap = {
                    info: "text-info",
                    success: "text-success",
                    warning: "text-warning",
                    error: "text-danger",
                };

                const entry = document.createElement("div");
                entry.className = "p-2 border-bottom";
                entry.innerHTML = `
                    <div class="d-flex align-items-start">
                        <i class="bi bi-${iconMap[type]} me-2 ${colorMap[type]} mt-1"></i>
                        <div class="flex-grow-1">
                            <div class="small">${message}</div>
                            <div class="text-muted" style="font-size: 0.75rem;">${timestamp}</div>
                        </div>
                    </div>
                `;

                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
                updateStats();
            }

            // Sample Views and Pages
            class WelcomeView extends View {
                constructor(options = {}) {
                    super({
                        template: `
                            <div class="p-2 bg-white border rounded">
                                <h6 class="mb-1">{{title}}</h6>
                                <p class="mb-2 small text-muted">{{description}}</p>
                                <button class="btn btn-sm btn-primary" data-action="click:greet">
                                    <i class="bi bi-hand-thumbs-up me-1"></i>{{buttonText}}
                                </button>
                            </div>
                        `,
                        data: {
                            title: "Welcome to MOJO!",
                            description:
                                "This is a basic View component with template and actions.",
                            buttonText: "Say Hello",
                        },
                        ...options,
                    });
                }

                async onActionGreet() {
                    logEvent("WelcomeView: Greet action triggered", "success");
                    this.showSuccess("Hello from MOJO Framework!");
                    this.data.buttonText = "Thanks!";
                    this.render();
                }
            }

            class HomePage extends Page {
                constructor(options = {}) {
                    super({
                        page_name: "home",
                        route: "/",
                        template: `
                            <div class="alert alert-primary py-2 mb-2">
                                <h6 class="mb-1">
                                    <i class="bi bi-house me-1"></i>Home Page
                                </h6>
                                <p class="mb-0 small">Welcome to the MOJO Framework basic example home page.</p>
                            </div>
                        `,
                        ...options,
                    });
                }

                on_params(params, query) {
                    logEvent(`HomePage: Navigated with params: ${JSON.stringify(params)}`, "info");
                    document.getElementById("current-route").textContent = "/";
                }
            }

            class AboutPage extends Page {
                constructor(options = {}) {
                    super({
                        page_name: "about",
                        route: "/about",
                        template: `
                            <div class="alert alert-info py-2 mb-2">
                                <h6 class="mb-1">
                                    <i class="bi bi-info-circle me-1"></i>About Page
                                </h6>
                                <p class="mb-1 small">MOJO Framework v2.0.0 - Phase 1: Core Architecture</p>
                                <p class="mb-0 small text-muted">Built with modern JavaScript and ES6 modules.</p>
                            </div>
                        `,
                        ...options,
                    });
                }

                on_params(params, query) {
                    logEvent("AboutPage: Navigated to about page", "info");
                    document.getElementById("current-route").textContent = "/about";
                }
            }

            class ContactPage extends Page {
                constructor(options = {}) {
                    super({
                        page_name: "contact",
                        route: "/contact",
                        template: `
                            <div class="alert alert-success py-2 mb-2">
                                <h6 class="mb-1">
                                    <i class="bi bi-envelope me-1"></i>Contact Page
                                </h6>
                                <p class="mb-0 small">Get in touch with the MOJO Framework team.</p>
                            </div>
                        `,
                        ...options,
                    });
                }

                on_params(params, query) {
                    logEvent("ContactPage: Navigated to contact page", "info");
                    document.getElementById("current-route").textContent = "/contact";
                }
            }

            // Global action functions
            window.createView = function () {
                viewCount++;
                const view = new WelcomeView({
                    container: "#app",
                });
                view.render();
                logEvent(`Created new WelcomeView (total: ${viewCount})`, "success");
                updateStats();
            };

            window.updateView = function () {
                logEvent("Updating existing views...", "info");
                // Simulate view update
                setTimeout(() => {
                    logEvent("Views updated successfully", "success");
                }, 500);
            };

            window.testEvents = function () {
                if (mojoInstance && mojoInstance.eventBus) {
                    mojoInstance.eventBus.emit("test:event", { timestamp: Date.now() });
                    logEvent("Test event emitted: test:event", "warning");
                } else {
                    logEvent("EventBus not available", "error");
                }
            };

            window.showHierarchy = function () {
                if (typeof MOJODevTools !== "undefined") {
                    const hierarchy = MOJODevTools.hierarchy();
                    console.log("MOJO View Hierarchy:", hierarchy);
                    logEvent("View hierarchy logged to console", "info");
                } else {
                    logEvent("Debug tools not available", "warning");
                }
            };

            window.navigateTo = function (page) {
                if (mojoInstance && mojoInstance.router) {
                    const routes = { home: "/", about: "/about", contact: "/contact" };
                    mojoInstance.router.navigate(routes[page] || "/");
                    logEvent(`Navigation: ${page} (${routes[page] || "/"})`, "info");
                }
            };

            window.clearLog = function () {
                const log = document.getElementById("event-log");
                log.innerHTML =
                    '<div class="p-2 text-muted"><i class="bi bi-info-circle me-1"></i>Log cleared</div>';
                eventCount = 0;
                updateStats();
            };

            // Initialize MOJO
            async function initializeApp() {
                try {
                    logEvent("Initializing MOJO Framework...", "info");

                    // Create MOJO instance
                    mojoInstance = MOJO.create({
                        container: "#app",
                        debug: true,
                    });

                    // Register pages
                    mojoInstance.addPage(new HomePage());
                    mojoInstance.addPage(new AboutPage());
                    mojoInstance.addPage(new ContactPage());

                    // Set up event listeners
                    mojoInstance.eventBus.on("*", (data, eventName) => {
                        logEvent(`EventBus: ${eventName}`, "info");
                    });

                    // Start the application
                    await mojoInstance.start();

                    // Update UI
                    document.getElementById("status-badge").textContent = "Ready";
                    document.getElementById("status-badge").className = "badge bg-success";
                    document.getElementById("framework-version").textContent = "2.0.0";
                    document.getElementById("framework-debug").textContent = "Enabled";
                    document.getElementById("current-route").textContent = "/";

                    logEvent("MOJO Framework initialized successfully!", "success");

                    // Create initial view
                    setTimeout(() => createView(), 500);
                } catch (error) {
                    logEvent(`Initialization failed: ${error.message}`, "error");
                    document.getElementById("status-badge").textContent = "Error";
                    document.getElementById("status-badge").className = "badge bg-danger";
                }
            }

            // Start the application
            document.addEventListener("DOMContentLoaded", initializeApp);

            // Console welcome
            console.log(`
ðŸŽ¯ MOJO Basic Example Loaded
ðŸ“š Available Functions:
  - createView() : Create new view
  - updateView() : Update existing views
  - testEvents() : Test event system
  - showHierarchy() : Show view hierarchy
  - navigateTo(page) : Navigate between pages
  - clearLog() : Clear event log

ðŸ”§ Open browser DevTools to explore!
            `);
        </script>
    </body>
</html>
